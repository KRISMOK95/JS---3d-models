/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==o||null==a||null==c)throw new i;const u=r<<2|o>>4;if(s.push(u),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},r=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=r())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class h extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(d,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new h(i,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(p(n)&&p(r)){if(!f(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const i=e*Math.pow(n,t),s=Math.round(v*i*(Math.random()-.5)*2);return Math.min(y,i+s)}function E(t){return t&&t._delegate?t._delegate:t}class b{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class I{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===T?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class C{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new I(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const S=[];var A,D;(D=A||(A={}))[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";const _={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},k=A.INFO,N={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},x=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=N[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class R{constructor(t){this.name=t,this._logLevel=k,this._logHandler=x,this._userLogHandler=null,S.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}const L=(t,e)=>e.some((e=>t instanceof e));let M,O;const P=new WeakMap,F=new WeakMap,V=new WeakMap,B=new WeakMap,U=new WeakMap;let j={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return F.get(t);if("objectStoreNames"===e)return t.objectStoreNames||V.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return q(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function $(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),q(P.get(this))}:function(...t){return q(e.apply(z(this),t))}:function(t,...n){const i=e.call(z(this),t,...n);return V.set(i,t.sort?t.sort():[t]),q(i)}:(t instanceof IDBTransaction&&function(t){if(F.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));F.set(t,e)}(t),L(t,M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,j):t);var e}function q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(q(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&P.set(e,t)})).catch((()=>{})),U.set(e,t),e}(t);if(B.has(t))return B.get(t);const e=$(t);return e!==t&&(B.set(t,e),U.set(e,t)),e}const z=t=>U.get(t),K=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],G=new Map;function W(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(G.get(e))return G.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=H.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!K.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return G.set(e,r),r}var Q;Q=j,j={...Q,get:(t,e,n)=>W(t,e)||Q.get(t,e,n),has:(t,e)=>!!W(t,e)||Q.has(t,e)};class X{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Y="@firebase/app",J="0.9.10",Z=new R("@firebase/app"),tt="[DEFAULT]",et={[Y]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},nt=new Map,it=new Map;function st(t,e){try{t.container.addComponent(e)}catch(n){Z.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function rt(t){const e=t.name;if(it.has(e))return Z.debug(`There were multiple attempts to register component ${e}.`),!1;it.set(e,t);for(const e of nt.values())st(e,t);return!0}function ot(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const at=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ct{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new b("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw at.create("app-deleted",{appName:this._name})}}function ut(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:tt,automaticDataCollectionEnabled:!1},e),s=i.name;if("string"!=typeof s||!s)throw at.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw at.create("no-options");const r=nt.get(s);if(r){if(f(n,r.options)&&f(i,r.config))return r;throw at.create("duplicate-app",{appName:s})}const a=new C(s);for(const t of it.values())a.addComponent(t);const c=new ct(n,i,a);return nt.set(s,c),c}function ht(t=tt){const e=nt.get(t);if(!e&&t===tt&&o())return ut();if(!e)throw at.create("no-app",{appName:t});return e}function lt(t,e,n){var i;let s=null!==(i=et[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Z.warn(t.join(" "))}rt(new b(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const dt="firebase-heartbeat-database",ft=1,pt="firebase-heartbeat-store";let gt=null;function mt(){return gt||(gt=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=q(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(q(o.result),t.oldVersion,t.newVersion,q(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(dt,ft,{upgrade:(t,e)=>{0===e&&t.createObjectStore(pt)}}).catch((t=>{throw at.create("idb-open",{originalErrorMessage:t.message})}))),gt}async function yt(t,e){try{const n=(await mt()).transaction(pt,"readwrite"),i=n.objectStore(pt);await i.put(e,vt(t)),await n.done}catch(t){if(t instanceof h)Z.warn(t.message);else{const e=at.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}function vt(t){return`${t.name}!${t.options.appId}`}class wt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new bt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Et();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Et(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Tt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Tt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Et(){return(new Date).toISOString().substring(0,10)}class bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await mt();return await e.transaction(pt).objectStore(pt).get(vt(t))}catch(t){if(t instanceof h)Z.warn(t.message);else{const e=at.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Z.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Tt(t){return s(JSON.stringify({version:2,heartbeats:t})).length}rt(new b("platform-logger",(t=>new X(t)),"PRIVATE")),rt(new b("heartbeat",(t=>new wt(t)),"PRIVATE")),lt(Y,J,""),lt(Y,J,"esm2017"),lt("fire-js","");const It=(t,e)=>e.some((e=>t instanceof e));let Ct,St;const At=new WeakMap,Dt=new WeakMap,_t=new WeakMap,kt=new WeakMap,Nt=new WeakMap;let xt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Dt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||_t.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Lt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Rt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(St||(St=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Mt(this),t),Lt(At.get(this))}:function(...t){return Lt(e.apply(Mt(this),t))}:function(t,...n){const i=e.call(Mt(this),t,...n);return _t.set(i,t.sort?t.sort():[t]),Lt(i)}:(t instanceof IDBTransaction&&function(t){if(Dt.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));Dt.set(t,e)}(t),It(t,Ct||(Ct=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,xt):t);var e}function Lt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Lt(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&At.set(e,t)})).catch((()=>{})),Nt.set(e,t),e}(t);if(kt.has(t))return kt.get(t);const e=Rt(t);return e!==t&&(kt.set(t,e),Nt.set(e,t)),e}const Mt=t=>Nt.get(t),Ot=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],Ft=new Map;function Vt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Ft.get(e))return Ft.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Pt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Ot.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return Ft.set(e,r),r}xt=(t=>({...t,get:(e,n,i)=>Vt(e,n)||t.get(e,n,i),has:(e,n)=>!!Vt(e,n)||t.has(e,n)}))(xt);const Bt="@firebase/installations",Ut="0.6.4",jt=1e4,$t=`w:${Ut}`,qt="FIS_v2",zt="https://firebaseinstallations.googleapis.com/v1",Kt=36e5,Ht=new l("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Gt(t){return t instanceof h&&t.code.includes("request-failed")}function Wt({projectId:t}){return`${zt}/projects/${t}/installations`}function Qt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Xt(t,e){const n=(await e.json()).error;return Ht.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Yt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Jt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Zt(t){return new Promise((e=>{setTimeout(e,t)}))}const te=/^[cdef][\w-]{21}$/,ee="";function ne(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return te.test(e)?e:ee}catch(t){return ee}}function ie(t){return`${t.appName}!${t.appId}`}const se=new Map;function re(t,e){const n=ie(t);oe(n,e),function(t,e){const n=(!ae&&"BroadcastChannel"in self&&(ae=new BroadcastChannel("[Firebase] FID Change"),ae.onmessage=t=>{oe(t.data.key,t.data.fid)}),ae);n&&n.postMessage({key:t,fid:e}),0===se.size&&ae&&(ae.close(),ae=null)}(n,e)}function oe(t,e){const n=se.get(t);if(n)for(const t of n)t(e)}let ae=null;const ce="firebase-installations-database",ue=1,he="firebase-installations-store";let le=null;function de(){return le||(le=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=Lt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Lt(o.result),t.oldVersion,t.newVersion,Lt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}(ce,ue,{upgrade:(t,e)=>{0===e&&t.createObjectStore(he)}})),le}async function fe(t,e){const n=ie(t),i=(await de()).transaction(he,"readwrite"),s=i.objectStore(he),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||re(t,e.fid),e}async function pe(t){const e=ie(t),n=(await de()).transaction(he,"readwrite");await n.objectStore(he).delete(e),await n.done}async function ge(t,e){const n=ie(t),i=(await de()).transaction(he,"readwrite"),s=i.objectStore(he),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||re(t,o.fid),o}async function me(t){let e;const n=await ge(t.appConfig,(n=>{const i=function(t){return we(t||{fid:ne(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Ht.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Wt(t),s=Yt(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:qt,appId:t.appId,sdkVersion:$t},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Jt((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Qt(t.authToken)}}throw await Xt("Create Installation",c)}(t,e);return fe(t.appConfig,n)}catch(n){throw Gt(n)&&409===n.customData.serverCode?await pe(t.appConfig):await fe(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ye(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return n.fid===ee?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ye(t){let e=await ve(t.appConfig);for(;1===e.registrationStatus;)await Zt(100),e=await ve(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await me(t);return n||e}return e}function ve(t){return ge(t,(t=>{if(!t)throw Ht.create("installation-not-found");return we(t)}))}function we(t){return 1===(e=t).registrationStatus&&e.registrationTime+jt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Ee({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Wt(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=Yt(t);return n.append("Authorization",function(t){return`${qt} ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:$t,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Jt((()=>fetch(i,a)));if(c.ok)return Qt(await c.json());throw await Xt("Generate Auth Token",c)}async function be(t,e=!1){let n;const i=await ge(t.appConfig,(i=>{if(!Ie(i))throw Ht.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Kt}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await Te(t.appConfig);for(;1===n.authToken.requestStatus;)await Zt(100),n=await Te(t.appConfig);const i=n.authToken;return 0===i.requestStatus?be(t,e):i}(t,e),i;{if(!navigator.onLine)throw Ht.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await Ee(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await fe(t.appConfig,i),n}catch(n){if(!Gt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await fe(t.appConfig,n)}else await pe(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Te(t){return ge(t,(t=>{if(!Ie(t))throw Ht.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+jt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Ie(t){return void 0!==t&&2===t.registrationStatus}function Ce(t){return Ht.create("missing-app-config-values",{valueName:t})}const Se="installations";rt(new b(Se,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Ce("App Configuration");if(!t.name)throw Ce("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Ce(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:ot(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),rt(new b("installations-internal",(t=>{const e=ot(t.getProvider("app").getImmediate(),Se).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await me(e);return i?i.catch(console.error):be(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await me(t);e&&await e}(n),(await be(n,e)).token}(e,t)}}),"PRIVATE")),lt(Bt,Ut),lt(Bt,Ut,"esm2017");const Ae="analytics",De="firebase_id",_e="origin",ke=6e4,Ne="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",xe="https://www.googletagmanager.com/gtag/js",Re=new R("@firebase/analytics"),Le=new l("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Me(t){if(!t.startsWith(xe)){const e=Le.create("invalid-gtag-resource",{gtagURL:t});return Re.warn(e.message),""}return t}function Oe(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Pe=30,Fe=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Ve(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Be(t,e=Fe,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Le.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Le.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new je;return setTimeout((async()=>{a.abort()}),void 0!==n?n:ke),Ue({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Ue(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=Fe){var r;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(Le.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return Re.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:Ve(i)},r=Ne.replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Le.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return s.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof h&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(s.deleteThrottleMetadata(o),a)return Re.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(r=null==c?void 0:c.customData)||void 0===r?void 0:r.httpStatus)?w(n,s.intervalMillis,Pe):w(n,s.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return s.setThrottleMetadata(o,l),Re.debug(`Calling attemptFetch again in ${u} millis`),Ue(t,l,i,s)}}class je{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let $e,qe;async function ze(t,e,n,i,s,r,o){var a;const h=Be(t);h.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Re.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Re.error(t))),e.push(h);const l=async function(){if(!c())return Re.warn(Le.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return Re.warn(Le.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([h,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(xe)&&n.src.includes(t))return n;return null})(r)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Me}),i=document.createElement("script"),s=`${xe}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}(r,d.measurementId),qe&&(s("consent","default",qe),qe=void 0),s("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[_e]="firebase",p.update=!0,null!=f&&(p[De]=f),s("config",d.measurementId,p),$e&&(s("set",$e),$e=void 0),d.measurementId}class Ke{constructor(t){this.app=t}_delete(){return delete He[this.app.options.appId],Promise.resolve()}}let He={},Ge=[];const We={};let Qe,Xe,Ye="dataLayer",Je=!1;function Ze(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Le.create("invalid-analytics-context",{errorInfo:e});Re.warn(n.message)}}();const i=t.options.appId;if(!i)throw Le.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Le.create("no-api-key");Re.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=He[i])throw Le.create("already-exists",{id:i});if(!Je){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(Ye);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(t,e,n,i){return async function(s,...r){try{if("event"===s){const[i,s]=r;await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await Oe(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){Re.error(t)}}(t,e,n,i,s)}else if("config"===s){const[s,o]=r;await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await Oe(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){Re.error(t)}t("config",s,r)}(t,e,n,i,s,o)}else if("consent"===s){const[e]=r;t("consent","update",e)}else if("get"===s){const[e,n,i]=r;t("get",e,n,i)}else if("set"===s){const[e]=r;t("set",e)}else t(s,...r)}catch(t){Re.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window[s]}}(He,Ge,We,Ye,"gtag");Xe=t,Qe=e,Je=!0}return He[i]=ze(t,Ge,We,e,Qe,Ye,n),new Ke(t)}const tn="@firebase/analytics",en="0.10.0";rt(new b(Ae,((t,{options:e})=>Ze(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),rt(new b("analytics-internal",(function(t){try{const e=t.getProvider(Ae).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=E(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(Xe,He[t.app.options.appId],e,n,i).catch((t=>Re.error(t)))}(e,t,n,i)}}catch(t){throw Le.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),lt(tn,en),lt(tn,en,"esm2017");var nn,sn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},rn={},on=on||{},an=sn||self;function cn(){}function un(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function hn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ln="closure_uid_"+(1e9*Math.random()>>>0),dn=0;function fn(t,e,n){return t.call.apply(t.bind,arguments)}function pn(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function gn(t,e,n){return(gn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?fn:pn).apply(null,arguments)}function mn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function yn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function vn(){this.s=this.s,this.o=this.o}vn.prototype.s=!1,vn.prototype.ra=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,ln)&&t[ln]||(t[ln]=++dn))},vn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const wn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function En(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function bn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(un(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let s=0;s<i;s++)t[e+s]=n[s]}else t.push(n)}}function Tn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Tn.prototype.h=function(){this.defaultPrevented=!0};var In=function(){if(!an.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{an.addEventListener("test",cn,e),an.removeEventListener("test",cn,e)}catch(t){}return t}();function Cn(t){return/^[\s\xa0]*$/.test(t)}var Sn=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function An(t,e){return t<e?-1:t>e?1:0}function Dn(){var t=an.navigator;return t&&(t=t.userAgent)?t:""}function _n(t){return-1!=Dn().indexOf(t)}function kn(t){return kn[" "](t),t}function Nn(t,e,n){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=n(e)}kn[" "]=cn;var xn,Rn,Ln=_n("Opera"),Mn=_n("Trident")||_n("MSIE"),On=_n("Edge"),Pn=On||Mn,Fn=_n("Gecko")&&!(-1!=Dn().toLowerCase().indexOf("webkit")&&!_n("Edge"))&&!(_n("Trident")||_n("MSIE"))&&!_n("Edge"),Vn=-1!=Dn().toLowerCase().indexOf("webkit")&&!_n("Edge");function Bn(){var t=an.document;return t?t.documentMode:void 0}t:{var Un="",jn=(Rn=Dn(),Fn?/rv:([^\);]+)(\)|;)/.exec(Rn):On?/Edge\/([\d\.]+)/.exec(Rn):Mn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Rn):Vn?/WebKit\/(\S+)/.exec(Rn):Ln?/(?:Version)[ \/]?(\S+)/.exec(Rn):void 0);if(jn&&(Un=jn?jn[1]:""),Mn){var $n=Bn();if(null!=$n&&$n>parseFloat(Un)){xn=String($n);break t}}xn=Un}var qn,zn={};an.document&&Mn?qn=Bn()||parseInt(xn,10)||void 0:qn=void 0;var Kn=qn;function Hn(t,e){if(Tn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Fn){t:{try{kn(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Gn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Hn.$.h.call(this)}}yn(Hn,Tn);var Gn={2:"touch",3:"pen",4:"mouse"};Hn.prototype.h=function(){Hn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Wn="closure_listenable_"+(1e6*Math.random()|0),Qn=0;function Xn(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=s,this.key=++Qn,this.fa=this.ia=!1}function Yn(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Jn(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Zn(t){const e={};for(const n in t)e[n]=t[n];return e}const ti="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ei(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<ti.length;e++)n=ti[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function ni(t){this.src=t,this.g={},this.h=0}function ii(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=wn(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Yn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function si(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.fa&&r.listener==e&&r.capture==!!n&&r.la==i)return s}return-1}ni.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=si(t,e,i,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Xn(e,this.src,r,!!i,s)).ia=n,t.push(e)),e};var ri="closure_lm_"+(1e6*Math.random()|0),oi={};function ai(t,e,n,i,s){if(i&&i.once)return ui(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)ai(t,e[r],n,i,s);return null}return n=mi(n),t&&t[Wn]?t.O(e,n,hn(i)?!!i.capture:!!i,s):ci(t,e,n,!1,i,s)}function ci(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=hn(s)?!!s.capture:!!s,a=pi(t);if(a||(t[ri]=a=new ni(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){const t=fi;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)In||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(di(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function ui(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)ui(t,e[r],n,i,s);return null}return n=mi(n),t&&t[Wn]?t.P(e,n,hn(i)?!!i.capture:!!i,s):ci(t,e,n,!0,i,s)}function hi(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)hi(t,e[r],n,i,s);else i=hn(i)?!!i.capture:!!i,n=mi(n),t&&t[Wn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=si(r=t.g[e],n,i,s))&&(Yn(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=pi(t))&&(e=t.g[e.toString()],t=-1,e&&(t=si(e,n,i,s)),(n=-1<t?e[t]:null)&&li(n))}function li(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Wn])ii(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(di(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=pi(e))?(ii(n,t),0==n.h&&(n.src=null,e[ri]=null)):Yn(t)}}}function di(t){return t in oi?oi[t]:oi[t]="on"+t}function fi(t,e){if(t.fa)t=!0;else{e=new Hn(e,this);var n=t.listener,i=t.la||t.src;t.ia&&li(t),t=n.call(i,e)}return t}function pi(t){return(t=t[ri])instanceof ni?t:null}var gi="__closure_events_fn_"+(1e9*Math.random()>>>0);function mi(t){return"function"==typeof t?t:(t[gi]||(t[gi]=function(e){return t.handleEvent(e)}),t[gi])}function yi(){vn.call(this),this.i=new ni(this),this.S=this,this.J=null}function vi(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Tn(e,t);else if(e instanceof Tn)e.target=e.target||t;else{var s=e;ei(e=new Tn(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=wi(o,i,!0,e)&&s}if(s=wi(o=e.g=t,i,!0,e)&&s,s=wi(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=wi(o=e.g=n[r],i,!1,e)&&s}function wi(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ii(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}yn(yi,vn),yi.prototype[Wn]=!0,yi.prototype.removeEventListener=function(t,e,n,i){hi(this,t,e,n,i)},yi.prototype.N=function(){if(yi.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Yn(n[i]);delete e.g[t],e.h--}}this.J=null},yi.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},yi.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var Ei=an.JSON.stringify;function bi(){var t=_i;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ti,Ii=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ci),(t=>t.reset()));class Ci{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Si(t){an.setTimeout((()=>{throw t}),0)}function Ai(t,e){Ti||function(){var t=an.Promise.resolve(void 0);Ti=function(){t.then(ki)}}(),Di||(Ti(),Di=!0),_i.add(t,e)}var Di=!1,_i=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ii.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function ki(){for(var t;t=bi();){try{t.h.call(t.g)}catch(t){Si(t)}var e=Ii;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Di=!1}function Ni(t,e){yi.call(this),this.h=t||1,this.g=e||an,this.j=gn(this.qb,this),this.l=Date.now()}function xi(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Ri(t,e,n){if("function"==typeof t)n&&(t=gn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=gn(t.handleEvent,t)}return 2147483647<Number(e)?-1:an.setTimeout(t,e||0)}function Li(t){t.g=Ri((()=>{t.g=null,t.i&&(t.i=!1,Li(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}yn(Ni,yi),(nn=Ni.prototype).ga=!1,nn.T=null,nn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),vi(this,"tick"),this.ga&&(xi(this),this.start()))}},nn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nn.N=function(){Ni.$.N.call(this),xi(this),delete this.g};class Mi extends vn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Li(this)}N(){super.N(),this.g&&(an.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oi(t){vn.call(this),this.h=t,this.g={}}yn(Oi,vn);var Pi=[];function Fi(t,e,n,i){Array.isArray(n)||(n&&(Pi[0]=n.toString()),n=Pi);for(var s=0;s<n.length;s++){var r=ai(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Vi(t){Jn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&li(t)}),t),t.g={}}function Bi(){this.g=!0}function Ui(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return Ei(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Oi.prototype.N=function(){Oi.$.N.call(this),Vi(this)},Oi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Bi.prototype.Ea=function(){this.g=!1},Bi.prototype.info=function(){};var ji={},$i=null;function qi(){return $i=$i||new yi}function zi(t){Tn.call(this,ji.Ta,t)}function Ki(t){const e=qi();vi(e,new zi(e))}function Hi(t,e){Tn.call(this,ji.STAT_EVENT,t),this.stat=e}function Gi(t){const e=qi();vi(e,new Hi(e,t))}function Wi(t,e){Tn.call(this,ji.Ua,t),this.size=e}function Qi(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return an.setTimeout((function(){t()}),e)}ji.Ta="serverreachability",yn(zi,Tn),ji.STAT_EVENT="statevent",yn(Hi,Tn),ji.Ua="timingevent",yn(Wi,Tn);var Xi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Yi={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ji(){}function Zi(t){return t.h||(t.h=t.i())}function ts(){}Ji.prototype.h=null;var es,ns={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function is(){Tn.call(this,"d")}function ss(){Tn.call(this,"c")}function rs(){}function os(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Oi(this),this.P=cs,t=Pn?125:void 0,this.V=new Ni(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.aa=-1,this.J=!1,this.O=0,this.M=null,this.ca=this.K=this.ba=this.S=!1,this.h=new as}function as(){this.i=null,this.g="",this.h=!1}yn(is,Tn),yn(ss,Tn),yn(rs,Ji),rs.prototype.g=function(){return new XMLHttpRequest},rs.prototype.i=function(){return{}},es=new rs;var cs=45e3,us={},hs={};function ls(t,e,n){t.L=1,t.v=Ns(Ss(e)),t.s=n,t.S=!0,ds(t,null)}function ds(t,e){t.G=Date.now(),ms(t),t.A=Ss(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),qs(n.i,"t",i),t.C=0,n=t.l.I,t.h=new as,t.g=$r(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Mi(gn(t.Pa,t,t.g),t.O)),Fi(t.U,t.g,"readystatechange",t.nb),e=t.I?Zn(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Ki(),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function fs(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function ps(t,e,n){let i,s=!0;for(;!t.J&&t.C<n.length;){if(i=gs(t,n),i==hs){4==e&&(t.o=4,Gi(14),s=!1),Ui(t.j,t.m,null,"[Incomplete Response]");break}if(i==us){t.o=4,Gi(15),Ui(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Ui(t.j,t.m,i,null),bs(t,i)}fs(t)&&i!=hs&&i!=us&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Gi(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ca&&(t.ca=!0,(e=t.l).g==t&&e.ca&&!e.L&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Mr(e),e.L=!0,Gi(11))):(Ui(t.j,t.m,n,"[Invalid Chunked Response]"),Es(t),ws(t))}function gs(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?hs:(n=Number(e.substring(n,i)),isNaN(n)?us:(i+=1)+n>e.length?hs:(e=e.substr(i,n),t.C=i+n,e))}function ms(t){t.Y=Date.now()+t.P,ys(t,t.P)}function ys(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Qi(gn(t.lb,t),e)}function vs(t){t.B&&(an.clearTimeout(t.B),t.B=null)}function ws(t){0==t.l.H||t.J||Fr(t.l,t)}function Es(t){vs(t);var e=t.M;e&&"function"==typeof e.ra&&e.ra(),t.M=null,xi(t.V),Vi(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ra())}function bs(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Qs(n.h,t)))if(!t.K&&Qs(n.h,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Pr(n),Ar(n)}Lr(n),Gi(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.M&&0==n.A&&!n.v&&(n.v=Qi(gn(n.ib,n),6e3));if(1>=Ws(n.h)&&n.na){try{n.na()}catch(t){}n.na=void 0}}else Br(n,11)}else if((t.K||n.g==t)&&Pr(n),!Cn(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.J=u[1],n.oa=u[2];const e=u[3];null!=e&&(n.qa=e,n.j.info("VER="+n.qa));const s=u[4];null!=s&&(n.Ga=s,n.j.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.K=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Xs(r,r.h),r.h=null))}if(i.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,ks(i.G,i.F,t))}}n.H=3,n.l&&n.l.Ba(),n.ca&&(n.S=Date.now()-t.G,n.j.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=jr(i,i.I?i.oa:null,i.Y),o.K){Ys(i.h,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(vs(a),ms(a)),i.g=o}else Rr(i);0<n.i.length&&_r(n)}else"stop"!=u[0]&&"close"!=u[0]||Br(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Br(n,7):Sr(n):"noop"!=u[0]&&n.l&&n.l.Aa(u),n.A=0)}Ki()}catch(t){}}function Ts(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(un(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.sa&&"function"==typeof t.sa)return t.sa();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(un(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(un(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}(nn=os.prototype).setTimeout=function(t){this.P=t},nn.nb=function(t){t=t.target;const e=this.M;e&&3==wr(t)?e.l():this.Pa(t)},nn.Pa=function(t){try{if(t==this.g)t:{const h=wr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||Pn||this.g&&(this.h.h||this.g.ja()||Er(this.g)))){this.J||4!=h||7==e||Ki(),vs(this);var n=this.g.da();this.aa=n;e:if(fs(this)){var i=Er(this.g);t="";var s=i.length,r=4==wr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Es(this),ws(this);var o="";break e}this.h.i=new an.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.ba&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Cn(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,Gi(12),Es(this),ws(this);break t}Ui(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bs(this,n)}this.S?(ps(this,h,o),Pn&&this.i&&3==h&&(Fi(this.U,this.V,"tick",this.mb),this.V.start())):(Ui(this.j,this.m,o,null),bs(this,o)),4==h&&Es(this),this.i&&!this.J&&(4==h?Fr(this.l,this):(this.i=!1,ms(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Gi(12)):(this.o=0,Gi(13)),Es(this),ws(this)}}}catch(t){}},nn.mb=function(){if(this.g){var t=wr(this.g),e=this.g.ja();this.C<e.length&&(vs(this),ps(this,t,e),this.i&&4!=t&&ms(this))}},nn.cancel=function(){this.J=!0,Es(this)},nn.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(Ki(),Gi(17)),Es(this),this.o=2,ws(this)):ys(this,this.Y-t)};var Is=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Cs(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Cs){this.h=void 0!==e?e:t.h,As(this,t.j),this.s=t.s,this.g=t.g,Ds(this,t.m),this.l=t.l,e=t.i;var n=new Bs;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),_s(this,n),this.o=t.o}else t&&(n=String(t).match(Is))?(this.h=!!e,As(this,n[1]||"",!0),this.s=xs(n[2]||""),this.g=xs(n[3]||"",!0),Ds(this,n[4]),this.l=xs(n[5]||"",!0),_s(this,n[6]||"",!0),this.o=xs(n[7]||"")):(this.h=!!e,this.i=new Bs(null,this.h))}function Ss(t){return new Cs(t)}function As(t,e,n){t.j=n?xs(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ds(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function _s(t,e,n){e instanceof Bs?(t.i=e,function(t,e){e&&!t.j&&(Us(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(js(this,e),qs(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Rs(e,Fs)),t.i=new Bs(e,t.h))}function ks(t,e,n){t.i.set(e,n)}function Ns(t){return ks(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xs(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Rs(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ls),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ls(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Cs.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Rs(e,Ms,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Rs(e,Ms,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Rs(n,"/"==n.charAt(0)?Ps:Os,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Rs(n,Vs)),t.join("")};var Ms=/[#\/\?@]/g,Os=/[#\?:]/g,Ps=/[#\?]/g,Fs=/[#\?@]/g,Vs=/#/g;function Bs(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Us(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function js(t,e){Us(t),e=zs(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function $s(t,e){return Us(t),e=zs(t,e),t.g.has(e)}function qs(t,e,n){js(t,e),0<n.length&&(t.i=null,t.g.set(zs(t,e),En(n)),t.h+=n.length)}function zs(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ks(t){this.l=t||Hs,t=an.PerformanceNavigationTiming?0<(t=an.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(an.g&&an.g.Ka&&an.g.Ka()&&an.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(nn=Bs.prototype).add=function(t,e){Us(this),this.i=null,t=zs(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},nn.forEach=function(t,e){Us(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},nn.sa=function(){Us(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const s=t[i];for(let t=0;t<s.length;t++)n.push(e[i])}return n},nn.Z=function(t){Us(this);let e=[];if("string"==typeof t)$s(this,t)&&(e=e.concat(this.g.get(zs(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},nn.set=function(t,e){return Us(this),this.i=null,$s(this,t=zs(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},nn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},nn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const r=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),t.push(s)}}return this.i=t.join("&")};var Hs=10;function Gs(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ws(t){return t.h?1:t.g?t.g.size:0}function Qs(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Xs(t,e){t.g?t.g.add(e):t.h=e}function Ys(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Js(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return En(t.i)}function Zs(){}function tr(){this.g=new Zs}function er(t,e,n){const i=n||"";try{Ts(t,(function(t,n){let s=t;hn(t)&&(s=Ei(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function nr(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function ir(t){this.l=t.fc||null,this.j=t.ob||!1}function sr(t,e){yi.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=rr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ks.prototype.cancel=function(){if(this.i=Js(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Zs.prototype.stringify=function(t){return an.JSON.stringify(t,void 0)},Zs.prototype.parse=function(t){return an.JSON.parse(t,void 0)},yn(ir,Ji),ir.prototype.g=function(){return new sr(this.l,this.j)},ir.prototype.i=function(t){return function(){return t}}({}),yn(sr,yi);var rr=0;function or(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function ar(t){t.readyState=4,t.l=null,t.j=null,t.A=null,cr(t)}function cr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(nn=sr.prototype).open=function(t,e){if(this.readyState!=rr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,cr(this)},nn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||an).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},nn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ar(this)),this.readyState=rr},nn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,cr(this)),this.g&&(this.readyState=3,cr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==an.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;or(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},nn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ar(this):cr(this),3==this.readyState&&or(this)}},nn.Za=function(t){this.g&&(this.response=this.responseText=t,ar(this))},nn.Ya=function(t){this.g&&(this.response=t,ar(this))},nn.ka=function(){this.g&&ar(this)},nn.setRequestHeader=function(t,e){this.v.append(t,e)},nn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},nn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(sr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ur=an.JSON.parse;function hr(t){yi.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=lr,this.L=this.M=!1}yn(hr,yi);var lr="",dr=/^https?$/i,fr=["POST","PUT"];function pr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,gr(t),yr(t)}function gr(t){t.F||(t.F=!0,vi(t,"complete"),vi(t,"error"))}function mr(t){if(t.h&&void 0!==on&&(!t.C[1]||4!=wr(t)||2!=t.da()))if(t.v&&4==wr(t))Ri(t.La,0,t);else if(vi(t,"readystatechange"),4==wr(t)){t.h=!1;try{const a=t.da();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===a){var s=String(t.I).match(Is)[1]||null;if(!s&&an.self&&an.self.location){var r=an.self.location.protocol;s=r.substr(0,r.length-1)}i=!dr.test(s?s.toLowerCase():"")}n=i}if(n)vi(t,"complete"),vi(t,"success");else{t.m=6;try{var o=2<wr(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.da()+"]",gr(t)}}finally{yr(t)}}}function yr(t,e){if(t.g){vr(t);const n=t.g,i=t.C[0]?cn:null;t.g=null,t.C=null,e||vi(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function vr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(an.clearTimeout(t.A),t.A=null)}function wr(t){return t.g?t.g.readyState:0}function Er(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case lr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function br(t){let e="";return Jn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Tr(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=br(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ks(t,e,n))}function Ir(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Cr(t){this.Ga=0,this.i=[],this.j=new Bi,this.oa=this.wa=this.G=this.Y=this.g=this.Da=this.F=this.ma=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ir("failFast",!1,t),this.M=this.v=this.u=this.m=this.l=null,this.aa=!0,this.ta=this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ir("baseRetryDelayMs",5e3,t),this.hb=Ir("retryDelaySeedMs",1e4,t),this.eb=Ir("forwardChannelMaxRetries",2,t),this.xa=Ir("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.K=void 0,this.I=t&&t.supportsCrossDomainXhr||!1,this.J="",this.h=new Ks(t&&t.concurrentRequestLimit),this.Ja=new tr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.j.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.na=void 0,this.S=0,this.L=!1,this.pa=this.B=null}function Sr(t){if(Dr(t),3==t.H){var e=t.W++,n=Ss(t.G);ks(n,"SID",t.J),ks(n,"RID",e),ks(n,"TYPE","terminate"),Nr(t,n),(e=new os(t,t.j,e,void 0)).L=2,e.v=Ns(Ss(n)),n=!1,an.navigator&&an.navigator.sendBeacon&&(n=an.navigator.sendBeacon(e.v.toString(),"")),!n&&an.Image&&((new Image).src=e.v,n=!0),n||(e.g=$r(e.l,null),e.g.ha(e.v)),e.G=Date.now(),ms(e)}Ur(t)}function Ar(t){t.g&&(Mr(t),t.g.cancel(),t.g=null)}function Dr(t){Ar(t),t.u&&(an.clearTimeout(t.u),t.u=null),Pr(t),t.h.cancel(),t.m&&("number"==typeof t.m&&an.clearTimeout(t.m),t.m=null)}function _r(t){Gs(t.h)||t.m||(t.m=!0,Ai(t.Na,t),t.C=0)}function kr(t,e){var n;n=e?e.m:t.W++;const i=Ss(t.G);ks(i,"SID",t.J),ks(i,"RID",n),ks(i,"AID",t.V),Nr(t,i),t.o&&t.s&&Tr(i,t.o,t.s),n=new os(t,t.j,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.i=e.F.concat(t.i)),e=xr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Xs(t.h,n),ls(n,i,e)}function Nr(t,e){t.ma&&Jn(t.ma,(function(t,n){ks(e,n,t)})),t.l&&Ts({},(function(t,n){ks(e,n,t)}))}function xr(t,e,n){n=Math.min(t.i.length,n);var i=t.l?gn(t.l.Va,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),r=!1;else try{er(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.i.splice(0,n),e.F=t,i}function Rr(t){t.g||t.u||(t.ba=1,Ai(t.Ma,t),t.A=0)}function Lr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Qi(gn(t.Ma,t),Vr(t,t.A)),t.A++,0))}function Mr(t){null!=t.B&&(an.clearTimeout(t.B),t.B=null)}function Or(t){t.g=new os(t,t.j,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ss(t.wa);ks(e,"RID","rpc"),ks(e,"SID",t.J),ks(e,"CI",t.M?"0":"1"),ks(e,"AID",t.V),ks(e,"TYPE","xmlhttp"),Nr(t,e),t.o&&t.s&&Tr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.oa,n.L=1,n.v=Ns(Ss(e)),n.s=null,n.S=!0,ds(n,t)}function Pr(t){null!=t.v&&(an.clearTimeout(t.v),t.v=null)}function Fr(t,e){var n=null;if(t.g==e){Pr(t),Mr(t),t.g=null;var i=2}else{if(!Qs(t.h,e))return;n=e.F,Ys(t.h,e),i=1}if(0!=t.H)if(t.ta=e.aa,e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var s=t.C;vi(i=qi(),new Wi(i,n)),_r(t)}else Rr(t);else if(3==(s=e.o)||0==s&&0<t.ta||!(1==i&&function(t,e){return!(Ws(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.F.concat(t.i),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Qi(gn(t.Na,t,e),Vr(t,t.C)),t.C++,0)))}(t,e)||2==i&&Lr(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:Br(t,5);break;case 4:Br(t,10);break;case 3:Br(t,6);break;default:Br(t,2)}}function Vr(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.l||(n*=2),n*e}function Br(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var i=gn(t.pb,t);n||(n=new Cs("//www.google.com/images/cleardot.gif"),an.location&&"http"==an.location.protocol||As(n,"https"),Ns(n)),function(t,e){const n=new Bi;if(an.Image){const i=new Image;i.onload=mn(nr,n,i,"TestLoadImage: loaded",!0,e),i.onerror=mn(nr,n,i,"TestLoadImage: error",!1,e),i.onabort=mn(nr,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=mn(nr,n,i,"TestLoadImage: timeout",!1,e),an.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Gi(2);t.H=0,t.l&&t.l.za(e),Ur(t),Dr(t)}function Ur(t){if(t.H=0,t.pa=[],t.l){const e=Js(t.h);0==e.length&&0==t.i.length||(bn(t.pa,e),bn(t.pa,t.i),t.h.i.length=0,En(t.i),t.i.length=0),t.l.ya()}}function jr(t,e,n){var i=n instanceof Cs?Ss(n):new Cs(n,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),Ds(i,i.m);else{var s=an.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Cs(null,void 0);i&&As(r,i),e&&(r.g=e),s&&Ds(r,s),n&&(r.l=n),i=r}return n=t.F,e=t.Da,n&&e&&ks(i,n,e),ks(i,"VER",t.qa),Nr(t,i),i}function $r(t,e,n){if(e&&!t.I)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new hr(new ir({ob:!0})):new hr(t.va)).Oa(t.I),e}function qr(){}function zr(){if(Mn&&!(10<=Number(Kn)))throw Error("Environmental error: no available transport.")}function Kr(t,e){yi.call(this),this.g=new Cr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Cn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Cn(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Wr(this)}function Hr(t){is.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Gr(){ss.call(this),this.status=1}function Wr(t){this.g=t}function Qr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Xr(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)i[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var r=t.g[3],o=e+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=n+(o<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(e=n+((o=e+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(e^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+r&4294967295}function Yr(t,e){this.h=e;for(var n=[],i=!0,s=t.length-1;0<=s;s--){var r=0|t[s];i&&r==e||(n[s]=r,i=!1)}this.g=n}(nn=hr.prototype).Oa=function(t){this.M=t},nn.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():es.g(),this.C=this.u?Zi(this.u):Zi(es),this.g.onreadystatechange=gn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void pr(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=an.FormData&&t instanceof an.FormData,!(0<=wn(fr,e))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{vr(this),0<this.B&&((this.L=function(t){return Mn&&Nn(zn,9,(function(){let t=0;const e=Sn(String(xn)).split("."),n=Sn("9").split("."),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=An(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||An(0==s[2].length,0==r[2].length)||An(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t}))&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=gn(this.ua,this)):this.A=Ri(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){pr(this,t)}},nn.ua=function(){void 0!==on&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vi(this,"timeout"),this.abort(8))},nn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,vi(this,"complete"),vi(this,"abort"),yr(this))},nn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),yr(this,!0)),hr.$.N.call(this)},nn.La=function(){this.s||(this.G||this.v||this.l?mr(this):this.kb())},nn.kb=function(){mr(this)},nn.da=function(){try{return 2<wr(this)?this.g.status:-1}catch(t){return-1}},nn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},nn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ur(e)}},nn.Ia=function(){return this.m},nn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(nn=Cr.prototype).qa=8,nn.H=1,nn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new os(this,this.j,t,void 0);let r=this.s;if(this.U&&(r?(r=Zn(r),ei(r,this.U)):r=this.U),null!==this.o||this.O||(s.I=r,r=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=xr(this,s,e),ks(n=Ss(this.G),"RID",t),ks(n,"CVER",22),this.F&&ks(n,"X-HTTP-Session-Id",this.F),Nr(this,n),r&&(this.O?e="headers="+encodeURIComponent(String(br(r)))+"&"+e:this.o&&Tr(n,this.o,r)),Xs(this.h,s),this.bb&&ks(n,"TYPE","init"),this.P?(ks(n,"$req",e),ks(n,"SID","null"),s.ba=!0,ls(s,n,null)):ls(s,n,e),this.H=2}}else 3==this.H&&(t?kr(this,t):0==this.i.length||Gs(this.h)||kr(this))},nn.Ma=function(){if(this.u=null,Or(this),this.ca&&!(this.L||null==this.g||0>=this.S)){var t=2*this.S;this.j.info("BP detection timer enabled: "+t),this.B=Qi(gn(this.jb,this),t)}},nn.jb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.M=!1,this.L=!0,Gi(10),Ar(this),Or(this))},nn.ib=function(){null!=this.v&&(this.v=null,Ar(this),Lr(this),Gi(19))},nn.pb=function(t){t?(this.j.info("Successfully pinged google.com"),Gi(2)):(this.j.info("Failed to ping google.com"),Gi(1))},(nn=qr.prototype).Ba=function(){},nn.Aa=function(){},nn.za=function(){},nn.ya=function(){},nn.Va=function(){},zr.prototype.g=function(t,e){return new Kr(t,e)},yn(Kr,yi),Kr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.I=!0);var t=this.g,e=this.l,n=this.h||void 0;Gi(0),t.Y=e,t.ma=n||{},t.M=t.aa,t.G=jr(t,null,t.Y),_r(t)},Kr.prototype.close=function(){Sr(this.g)},Kr.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ei(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.fb++,t)),3==e.H&&_r(e)},Kr.prototype.N=function(){this.g.l=null,delete this.j,Sr(this.g),delete this.g,Kr.$.N.call(this)},yn(Hr,is),yn(Gr,ss),yn(Wr,qr),Wr.prototype.Ba=function(){vi(this.g,"a")},Wr.prototype.Aa=function(t){vi(this.g,new Hr(t))},Wr.prototype.za=function(t){vi(this.g,new Gr)},Wr.prototype.ya=function(){vi(this.g,"b")},yn(Qr,(function(){this.blockSize=-1})),Qr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Qr.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,s=this.h,r=0;r<e;){if(0==s)for(;r<=n;)Xr(this,t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[s++]=t.charCodeAt(r++),s==this.blockSize){Xr(this,i),s=0;break}}else for(;r<e;)if(i[s++]=t[r++],s==this.blockSize){Xr(this,i),s=0;break}}this.h=s,this.i+=e},Qr.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var Jr={};function Zr(t){return-128<=t&&128>t?Nn(Jr,t,(function(t){return new Yr([0|t],0>t?-1:0)})):new Yr([0|t],0>t?-1:0)}function to(t){if(isNaN(t)||!isFinite(t))return no;if(0>t)return ao(to(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=eo;return new Yr(e,0)}var eo=4294967296,no=Zr(0),io=Zr(1),so=Zr(16777216);function ro(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function oo(t){return-1==t.h}function ao(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new Yr(n,~t.h).add(io)}function co(t,e){return t.add(ao(e))}function uo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ho(t,e){this.g=t,this.h=e}function lo(t,e){if(ro(e))throw Error("division by zero");if(ro(t))return new ho(no,no);if(oo(t))return e=lo(ao(t),e),new ho(ao(e.g),ao(e.h));if(oo(e))return e=lo(t,ao(e)),new ho(ao(e.g),e.h);if(30<t.g.length){if(oo(t)||oo(e))throw Error("slowDivide_ only works with positive integers.");for(var n=io,i=e;0>=i.X(t);)n=fo(n),i=fo(i);var s=po(n,1),r=po(i,1);for(i=po(i,2),n=po(n,2);!ro(i);){var o=r.add(i);0>=o.X(t)&&(s=s.add(n),r=o),i=po(i,1),n=po(n,1)}return e=co(t,s.R(e)),new ho(s,e)}for(s=no;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(r=to(n)).R(e);oo(o)||0<o.X(t);)o=(r=to(n-=i)).R(e);ro(r)&&(r=io),s=s.add(r),t=co(t,o)}return new ho(s,t)}function fo(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new Yr(n,t.h)}function po(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],r=0;r<i;r++)s[r]=0<e?t.D(r+n)>>>e|t.D(r+n+1)<<32-e:t.D(r+n);return new Yr(s,t.h)}(nn=Yr.prototype).ea=function(){if(oo(this))return-ao(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:eo+i)*e,e*=eo}return t},nn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ro(this))return"0";if(oo(this))return"-"+ao(this).toString(t);for(var e=to(Math.pow(t,6)),n=this,i="";;){var s=lo(n,e).g,r=((0<(n=co(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ro(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},nn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},nn.X=function(t){return oo(t=co(this,t))?-1:ro(t)?0:1},nn.abs=function(){return oo(this)?ao(this):this},nn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var r=i+(65535&this.D(s))+(65535&t.D(s)),o=(r>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);i=o>>>16,r&=65535,o&=65535,n[s]=o<<16|r}return new Yr(n,-2147483648&n[n.length-1]?-1:0)},nn.R=function(t){if(ro(this)||ro(t))return no;if(oo(this))return oo(t)?ao(this).R(ao(t)):ao(ao(this).R(t));if(oo(t))return ao(this.R(ao(t)));if(0>this.X(so)&&0>t.X(so))return to(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var r=this.D(i)>>>16,o=65535&this.D(i),a=t.D(s)>>>16,c=65535&t.D(s);n[2*i+2*s]+=o*c,uo(n,2*i+2*s),n[2*i+2*s+1]+=r*c,uo(n,2*i+2*s+1),n[2*i+2*s+1]+=o*a,uo(n,2*i+2*s+1),n[2*i+2*s+2]+=r*a,uo(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new Yr(n,0)},nn.gb=function(t){return lo(this,t).h},nn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new Yr(n,this.h&t.h)},nn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new Yr(n,this.h|t.h)},nn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new Yr(n,this.h^t.h)},zr.prototype.createWebChannel=zr.prototype.g,Kr.prototype.send=Kr.prototype.u,Kr.prototype.open=Kr.prototype.m,Kr.prototype.close=Kr.prototype.close,Xi.NO_ERROR=0,Xi.TIMEOUT=8,Xi.HTTP_ERROR=6,Yi.COMPLETE="complete",ts.EventType=ns,ns.OPEN="a",ns.CLOSE="b",ns.ERROR="c",ns.MESSAGE="d",yi.prototype.listen=yi.prototype.O,hr.prototype.listenOnce=hr.prototype.P,hr.prototype.getLastError=hr.prototype.Sa,hr.prototype.getLastErrorCode=hr.prototype.Ia,hr.prototype.getStatus=hr.prototype.da,hr.prototype.getResponseJson=hr.prototype.Wa,hr.prototype.getResponseText=hr.prototype.ja,hr.prototype.send=hr.prototype.ha,hr.prototype.setWithCredentials=hr.prototype.Oa,Qr.prototype.digest=Qr.prototype.l,Qr.prototype.reset=Qr.prototype.reset,Qr.prototype.update=Qr.prototype.j,Yr.prototype.add=Yr.prototype.add,Yr.prototype.multiply=Yr.prototype.R,Yr.prototype.modulo=Yr.prototype.gb,Yr.prototype.compare=Yr.prototype.X,Yr.prototype.toNumber=Yr.prototype.ea,Yr.prototype.toString=Yr.prototype.toString,Yr.prototype.getBits=Yr.prototype.D,Yr.fromNumber=to,Yr.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return ao(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=to(Math.pow(n,8)),s=no,r=0;r<e.length;r+=8){var o=Math.min(8,e.length-r),a=parseInt(e.substring(r,r+o),n);8>o?(o=to(Math.pow(n,o)),s=s.R(o).add(to(a))):s=(s=s.R(i)).add(to(a))}return s};var go=rn.createWebChannelTransport=function(){return new zr},mo=rn.getStatEventTarget=function(){return qi()},yo=rn.ErrorCode=Xi,vo=rn.EventType=Yi,wo=rn.Event=ji,Eo=rn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},bo=rn.FetchXmlHttpFactory=ir,To=rn.WebChannel=ts,Io=rn.XhrIo=hr,Co=rn.Md5=Qr,So=rn.Integer=Yr;const Ao="@firebase/firestore";class Do{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Do.UNAUTHENTICATED=new Do(null),Do.GOOGLE_CREDENTIALS=new Do("google-credentials-uid"),Do.FIRST_PARTY=new Do("first-party-uid"),Do.MOCK_USER=new Do("mock-user");let _o="9.22.0";const ko=new R("@firebase/firestore");function No(){return ko.logLevel}function xo(t,...e){if(ko.logLevel<=A.DEBUG){const n=e.map(Mo);ko.debug(`Firestore (${_o}): ${t}`,...n)}}function Ro(t,...e){if(ko.logLevel<=A.ERROR){const n=e.map(Mo);ko.error(`Firestore (${_o}): ${t}`,...n)}}function Lo(t,...e){if(ko.logLevel<=A.WARN){const n=e.map(Mo);ko.warn(`Firestore (${_o}): ${t}`,...n)}}function Mo(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Oo(t="Unexpected state"){const e=`FIRESTORE (${_o}) INTERNAL ASSERTION FAILED: `+t;throw Ro(e),new Error(e)}function Po(t,e){t||Oo()}function Fo(t,e){return t}const Vo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bo extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Uo{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class jo{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class $o{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Do.UNAUTHENTICATED)))}shutdown(){}}class qo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class zo{constructor(t){this.t=t,this.currentUser=Do.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Uo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Uo,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{xo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(xo("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Uo)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(xo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Po("string"==typeof e.accessToken),new jo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Po(null===t||"string"==typeof t),new Do(t)}}class Ko{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Do.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Ho{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Ko(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Do.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Go{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Wo{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&xo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,xo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{xo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?i(t):xo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Po("string"==typeof t.token),this.T=t.token,new Go(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Qo(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Xo{static A(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Qo(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function Yo(t,e){return t<e?-1:t>e?1:0}function Jo(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class Zo{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Bo(Vo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Bo(Vo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Bo(Vo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Bo(Vo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Zo.fromMillis(Date.now())}static fromDate(t){return Zo.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Zo(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Yo(this.nanoseconds,t.nanoseconds):Yo(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ta{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ta(t)}static min(){return new ta(new Zo(0,0))}static max(){return new ta(new Zo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ea{constructor(t,e,n){void 0===e?e=0:e>t.length&&Oo(),void 0===n?n=t.length-e:n>t.length-e&&Oo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ea.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ea?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class na extends ea{construct(t,e,n){return new na(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Bo(Vo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new na(e)}static emptyPath(){return new na([])}}const ia=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class sa extends ea{construct(t,e,n){return new sa(t,e,n)}static isValidIdentifier(t){return ia.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),sa.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new sa(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new Bo(Vo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new Bo(Vo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Bo(Vo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new Bo(Vo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new sa(e)}static emptyPath(){return new sa([])}}class ra{constructor(t){this.path=t}static fromPath(t){return new ra(na.fromString(t))}static fromName(t){return new ra(na.fromString(t).popFirst(5))}static empty(){return new ra(na.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===na.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return na.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ra(new na(t.slice()))}}function oa(t){return new aa(t.readTime,t.key,-1)}class aa{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new aa(ta.min(),ra.empty(),-1)}static max(){return new aa(ta.max(),ra.empty(),-1)}}function ca(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ra.comparator(t.documentKey,e.documentKey),0!==n?n:Yo(t.largestBatchId,e.largestBatchId))}const ua="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ha{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function la(t){if(t.code!==Vo.FAILED_PRECONDITION||t.message!==ua)throw t;xo("LocalStore","Unexpectedly lost primary lease")}class da{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Oo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new da(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof da?e:da.resolve(e)}catch(t){return da.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):da.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):da.reject(e)}static resolve(t){return new da(((e,n)=>{e(t)}))}static reject(t){return new da(((e,n)=>{n(t)}))}static waitFor(t){return new da(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=da.resolve(!1);for(const n of t)e=e.next((t=>t?da.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new da(((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===s&&n(r)}),(t=>i(t)))}}))}static doWhile(t,e){return new da(((n,i)=>{const s=()=>{!0===t()?e().next((()=>{s()}),i):n()};s()}))}}function fa(t){return"IndexedDbTransactionError"===t.name}class pa{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function ga(t){return null==t}function ma(t){return 0===t&&1/t==-1/0}pa.ct=-1;function ya(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function va(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class wa{constructor(t,e){this.comparator=t,this.root=e||ba.EMPTY}insert(t,e){return new wa(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ba.BLACK,null,null))}remove(t){return new wa(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ba.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ea(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ea(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ea(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ea(this.root,t,this.comparator,!0)}}class Ea{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ba{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:ba.RED,this.left=null!=i?i:ba.EMPTY,this.right=null!=s?s:ba.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new ba(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ba.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return ba.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ba.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ba.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Oo();if(this.right.isRed())throw Oo();const t=this.left.check();if(t!==this.right.check())throw Oo();return t+(this.isRed()?0:1)}}ba.EMPTY=null,ba.RED=!0,ba.BLACK=!1,ba.EMPTY=new class{constructor(){this.size=0}get key(){throw Oo()}get value(){throw Oo()}get color(){throw Oo()}get left(){throw Oo()}get right(){throw Oo()}copy(t,e,n,i,s){return this}insert(t,e,n){return new ba(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ta{constructor(t){this.comparator=t,this.data=new wa(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ia(this.data.getIterator())}getIteratorFrom(t){return new Ia(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ta))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ta(this.comparator);return e.data=t,e}}class Ia{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ca{constructor(t){this.fields=t,t.sort(sa.comparator)}static empty(){return new Ca([])}unionWith(t){let e=new Ta(sa.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ca(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Jo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Sa extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Aa{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Sa("Invalid base64 string: "+t):t}}(t);return new Aa(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Aa(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Yo(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Aa.EMPTY_BYTE_STRING=new Aa("");const Da=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _a(t){if(Po(!!t),"string"==typeof t){let e=0;const n=Da.exec(t);if(Po(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ka(t.seconds),nanos:ka(t.nanos)}}function ka(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Na(t){return"string"==typeof t?Aa.fromBase64String(t):Aa.fromUint8Array(t)}function xa(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ra(t){const e=t.mapValue.fields.__previous_value__;return xa(e)?Ra(e):e}function La(t){const e=_a(t.mapValue.fields.__local_write_time__.timestampValue);return new Zo(e.seconds,e.nanos)}class Ma{constructor(t,e,n,i,s,r,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Oa{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Oa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Oa&&t.projectId===this.projectId&&t.database===this.database}}const Pa={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Fa(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?xa(t)?4:Xa(t)?9007199254740991:10:Oo()}function Va(t,e){if(t===e)return!0;const n=Fa(t);if(n!==Fa(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return La(t).isEqual(La(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=_a(t.timestampValue),i=_a(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Na(t.bytesValue).isEqual(Na(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ka(t.geoPointValue.latitude)===ka(e.geoPointValue.latitude)&&ka(t.geoPointValue.longitude)===ka(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ka(t.integerValue)===ka(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ka(t.doubleValue),i=ka(e.doubleValue);return n===i?ma(n)===ma(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return Jo(t.arrayValue.values||[],e.arrayValue.values||[],Va);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(ya(n)!==ya(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Va(n[t],i[t])))return!1;return!0}(t,e);default:return Oo()}}function Ba(t,e){return void 0!==(t.values||[]).find((t=>Va(t,e)))}function Ua(t,e){if(t===e)return 0;const n=Fa(t),i=Fa(e);if(n!==i)return Yo(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Yo(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ka(t.integerValue||t.doubleValue),i=ka(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return ja(t.timestampValue,e.timestampValue);case 4:return ja(La(t),La(e));case 5:return Yo(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Na(t),i=Na(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=Yo(n[t],i[t]);if(0!==e)return e}return Yo(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Yo(ka(t.latitude),ka(e.latitude));return 0!==n?n:Yo(ka(t.longitude),ka(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Ua(n[t],i[t]);if(e)return e}return Yo(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Pa.mapValue&&e===Pa.mapValue)return 0;if(t===Pa.mapValue)return 1;if(e===Pa.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=Yo(i[t],r[t]);if(0!==e)return e;const o=Ua(n[i[t]],s[r[t]]);if(0!==o)return o}return Yo(i.length,r.length)}(t.mapValue,e.mapValue);default:throw Oo()}}function ja(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Yo(t,e);const n=_a(t),i=_a(e),s=Yo(n.seconds,i.seconds);return 0!==s?s:Yo(n.nanos,i.nanos)}function $a(t){return qa(t)}function qa(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=_a(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Na(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ra.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=qa(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${qa(t.fields[s])}`;return n+"}"}(t.mapValue):Oo();var e,n}function za(t){return!!t&&"integerValue"in t}function Ka(t){return!!t&&"arrayValue"in t}function Ha(t){return!!t&&"nullValue"in t}function Ga(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Wa(t){return!!t&&"mapValue"in t}function Qa(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return va(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Qa(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Qa(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Xa(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ya{constructor(t){this.value=t}static empty(){return new Ya({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Wa(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Qa(e)}setAll(t){let e=sa.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=Qa(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());Wa(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Va(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Wa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){va(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ya(Qa(this.value))}}class Ja{constructor(t,e,n,i,s,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(t){return new Ja(t,0,ta.min(),ta.min(),ta.min(),Ya.empty(),0)}static newFoundDocument(t,e,n,i){return new Ja(t,1,e,ta.min(),n,i,0)}static newNoDocument(t,e){return new Ja(t,2,e,ta.min(),ta.min(),Ya.empty(),0)}static newUnknownDocument(t,e){return new Ja(t,3,e,ta.min(),ta.min(),Ya.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ta.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ya.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ya.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ta.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ja&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ja(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Za{constructor(t,e){this.position=t,this.inclusive=e}}function tc(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?ra.comparator(ra.fromName(o.referenceValue),n.key):Ua(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function ec(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Va(t.position[n],e.position[n]))return!1;return!0}class nc{constructor(t,e="asc"){this.field=t,this.dir=e}}function ic(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class sc{}class rc extends sc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new dc(t,e,n):"array-contains"===e?new mc(t,n):"in"===e?new yc(t,n):"not-in"===e?new vc(t,n):"array-contains-any"===e?new wc(t,n):new rc(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new fc(t,n):new pc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Ua(e,this.value)):null!==e&&Fa(this.value)===Fa(e)&&this.matchesComparison(Ua(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Oo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class oc extends sc{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new oc(t,e)}matches(t){return ac(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function ac(t){return"and"===t.op}function cc(t){return function(t){for(const e of t.filters)if(e instanceof oc)return!1;return!0}(t)&&ac(t)}function uc(t){if(t instanceof rc)return t.field.canonicalString()+t.op.toString()+$a(t.value);if(cc(t))return t.filters.map((t=>uc(t))).join(",");{const e=t.filters.map((t=>uc(t))).join(",");return`${t.op}(${e})`}}function hc(t,e){return t instanceof rc?function(t,e){return e instanceof rc&&t.op===e.op&&t.field.isEqual(e.field)&&Va(t.value,e.value)}(t,e):t instanceof oc?function(t,e){return e instanceof oc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&hc(n,e.filters[i])),!0)}(t,e):void Oo()}function lc(t){return t instanceof rc?function(t){return`${t.field.canonicalString()} ${t.op} ${$a(t.value)}`}(t):t instanceof oc?function(t){return t.op.toString()+" {"+t.getFilters().map(lc).join(" ,")+"}"}(t):"Filter"}class dc extends rc{constructor(t,e,n){super(t,e,n),this.key=ra.fromName(n.referenceValue)}matches(t){const e=ra.comparator(t.key,this.key);return this.matchesComparison(e)}}class fc extends rc{constructor(t,e){super(t,"in",e),this.keys=gc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class pc extends rc{constructor(t,e){super(t,"not-in",e),this.keys=gc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function gc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ra.fromName(t.referenceValue)))}class mc extends rc{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ka(e)&&Ba(e.arrayValue,this.value)}}class yc extends rc{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ba(this.value.arrayValue,e)}}class vc extends rc{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ba(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ba(this.value.arrayValue,e)}}class wc extends rc{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ka(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ba(this.value.arrayValue,t)))}}class Ec{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.dt=null}}function bc(t,e=null,n=[],i=[],s=null,r=null,o=null){return new Ec(t,e,n,i,s,r,o)}function Tc(t){const e=Fo(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>uc(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ga(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>$a(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>$a(t))).join(",")),e.dt=t}return e.dt}function Ic(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ic(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!hc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ec(t.startAt,e.startAt)&&ec(t.endAt,e.endAt)}function Cc(t){return ra.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Sc{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Ac(t){return new Sc(t)}function Dc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function _c(t){const e=Fo(t);if(null===e.wt){e.wt=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new nc(t)),e.wt.push(new nc(sa.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new nc(sa.keyField(),t))}}}return e.wt}function kc(t){const e=Fo(t);if(!e._t)if("F"===e.limitType)e._t=bc(e.path,e.collectionGroup,_c(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of _c(e)){const e="desc"===n.dir?"asc":"desc";t.push(new nc(n.field,e))}const n=e.endAt?new Za(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Za(e.startAt.position,e.startAt.inclusive):null;e._t=bc(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e._t}function Nc(t,e,n){return new Sc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function xc(t,e){return Ic(kc(t),kc(e))&&t.limitType===e.limitType}function Rc(t){return`${Tc(kc(t))}|lt:${t.limitType}`}function Lc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>lc(t))).join(", ")}]`),ga(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>$a(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>$a(t))).join(",")),`Target(${e})`}(kc(t))}; limitType=${t.limitType})`}function Mc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ra.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of _c(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=tc(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,_c(t),e)||t.endAt&&!function(t,e,n){const i=tc(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,_c(t),e))}(t,e)}function Oc(t){return(e,n)=>{let i=!1;for(const s of _c(t)){const t=Pc(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function Pc(t,e,n){const i=t.field.isKeyField()?ra.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?Ua(i,s):Oo()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Oo()}}class Fc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){va(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Vc=new wa(ra.comparator);function Bc(){return Vc}const Uc=new wa(ra.comparator);function jc(...t){let e=Uc;for(const n of t)e=e.insert(n.key,n);return e}function $c(t){let e=Uc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function qc(){return Kc()}function zc(){return Kc()}function Kc(){return new Fc((t=>t.toString()),((t,e)=>t.isEqual(e)))}new wa(ra.comparator);const Hc=new Ta(ra.comparator);function Gc(...t){let e=Hc;for(const n of t)e=e.add(n);return e}const Wc=new Ta(Yo);class Qc{constructor(){this._=void 0}}function Xc(t,e,n){return t instanceof Jc?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&xa(e)&&(e=Ra(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Zc?tu(t,e):t instanceof eu?nu(t,e):function(t,e){const n=function(t,e){return t instanceof iu?za(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}(t,e),i=su(n)+su(t.gt);return za(n)&&za(t.gt)?function(t){return{integerValue:""+t}}(i):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ma(e)?"-0":e}}(t.serializer,i)}(t,e)}function Yc(t,e,n){return t instanceof Zc?tu(t,e):t instanceof eu?nu(t,e):n}class Jc extends Qc{}class Zc extends Qc{constructor(t){super(),this.elements=t}}function tu(t,e){const n=ru(e);for(const e of t.elements)n.some((t=>Va(t,e)))||n.push(e);return{arrayValue:{values:n}}}class eu extends Qc{constructor(t){super(),this.elements=t}}function nu(t,e){let n=ru(e);for(const e of t.elements)n=n.filter((t=>!Va(t,e)));return{arrayValue:{values:n}}}class iu extends Qc{constructor(t,e){super(),this.serializer=t,this.gt=e}}function su(t){return ka(t.integerValue||t.doubleValue)}function ru(t){return Ka(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class ou{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ou}static exists(t){return new ou(void 0,t)}static updateTime(t){return new ou(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function au(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class cu{}function uu(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new vu(t.key,ou.none()):new fu(t.key,t.data,ou.none());{const n=t.data,i=Ya.empty();let s=new Ta(sa.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new pu(t.key,i,new Ca(s.toArray()),ou.none())}}function hu(t,e,n){t instanceof fu?function(t,e,n){const i=t.value.clone(),s=mu(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof pu?function(t,e,n){if(!au(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=mu(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(gu(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function lu(t,e,n,i){return t instanceof fu?function(t,e,n,i){if(!au(t.precondition,e))return n;const s=t.value.clone(),r=yu(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof pu?function(t,e,n,i){if(!au(t.precondition,e))return n;const s=yu(t.fieldTransforms,i,e),r=e.data;return r.setAll(gu(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return au(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function du(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Jo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Zc&&e instanceof Zc||t instanceof eu&&e instanceof eu?Jo(t.elements,e.elements,Va):t instanceof iu&&e instanceof iu?Va(t.gt,e.gt):t instanceof Jc&&e instanceof Jc}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fu extends cu{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pu extends cu{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gu(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function mu(t,e,n){const i=new Map;Po(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,Yc(o,a,n[s]))}return i}function yu(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,Xc(t,r,e))}return i}class vu extends cu{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wu{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&hu(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=lu(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=lu(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=zc();return this.mutations.forEach((i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=uu(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(ta.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Gc())}isEqual(t){return this.batchId===t.batchId&&Jo(this.mutations,t.mutations,((t,e)=>du(t,e)))&&Jo(this.baseMutations,t.baseMutations,((t,e)=>du(t,e)))}}class Eu{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class bu{constructor(t,e){this.count=t,this.unchangedNames=e}}var Tu,Iu;function Cu(t){if(void 0===t)return Ro("GRPC error has no .code"),Vo.UNKNOWN;switch(t){case Tu.OK:return Vo.OK;case Tu.CANCELLED:return Vo.CANCELLED;case Tu.UNKNOWN:return Vo.UNKNOWN;case Tu.DEADLINE_EXCEEDED:return Vo.DEADLINE_EXCEEDED;case Tu.RESOURCE_EXHAUSTED:return Vo.RESOURCE_EXHAUSTED;case Tu.INTERNAL:return Vo.INTERNAL;case Tu.UNAVAILABLE:return Vo.UNAVAILABLE;case Tu.UNAUTHENTICATED:return Vo.UNAUTHENTICATED;case Tu.INVALID_ARGUMENT:return Vo.INVALID_ARGUMENT;case Tu.NOT_FOUND:return Vo.NOT_FOUND;case Tu.ALREADY_EXISTS:return Vo.ALREADY_EXISTS;case Tu.PERMISSION_DENIED:return Vo.PERMISSION_DENIED;case Tu.FAILED_PRECONDITION:return Vo.FAILED_PRECONDITION;case Tu.ABORTED:return Vo.ABORTED;case Tu.OUT_OF_RANGE:return Vo.OUT_OF_RANGE;case Tu.UNIMPLEMENTED:return Vo.UNIMPLEMENTED;case Tu.DATA_LOSS:return Vo.DATA_LOSS;default:return Oo()}}(Iu=Tu||(Tu={}))[Iu.OK=0]="OK",Iu[Iu.CANCELLED=1]="CANCELLED",Iu[Iu.UNKNOWN=2]="UNKNOWN",Iu[Iu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Iu[Iu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Iu[Iu.NOT_FOUND=5]="NOT_FOUND",Iu[Iu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Iu[Iu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Iu[Iu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Iu[Iu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Iu[Iu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Iu[Iu.ABORTED=10]="ABORTED",Iu[Iu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Iu[Iu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Iu[Iu.INTERNAL=13]="INTERNAL",Iu[Iu.UNAVAILABLE=14]="UNAVAILABLE",Iu[Iu.DATA_LOSS=15]="DATA_LOSS";class Su{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Au}static getOrCreateInstance(){return null===Au&&(Au=new Su),Au}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let Au=null;const Du=new So([4294967295,4294967295],0);function _u(t){const e=(new TextEncoder).encode(t),n=new Co;return n.update(e),new Uint8Array(n.digest())}function ku(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new So([n,i],0),new So([s,r],0)]}class Nu{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new xu(`Invalid padding: ${e}`);if(n<0)throw new xu(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new xu(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new xu(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=So.fromNumber(this.It)}Et(t,e,n){let i=t.add(e.multiply(So.fromNumber(n)));return 1===i.compare(Du)&&(i=new So([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=_u(t),[n,i]=ku(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),r=new Nu(s,i,e);return n.forEach((t=>r.insert(t))),r}insert(t){if(0===this.It)return;const e=_u(t),[n,i]=ku(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,i,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class xu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ru{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,Lu.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Ru(ta.min(),i,new wa(Yo),Bc(),Gc())}}class Lu{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Lu(n,e,Gc(),Gc(),Gc())}}class Mu{constructor(t,e,n,i){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=i}}class Ou{constructor(t,e){this.targetId=t,this.Vt=e}}class Pu{constructor(t,e,n=Aa.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Fu{constructor(){this.St=0,this.Dt=Uu(),this.Ct=Aa.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=Gc(),e=Gc(),n=Gc();return this.Dt.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:Oo()}})),new Lu(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=Uu()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class Vu{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=Bc(),this.zt=Bu(),this.Wt=new wa(Yo)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:Oo()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,i=t.Vt.count,s=this.se(n);if(s){const r=s.target;if(Cc(r))if(0===i){const t=new ra(r.path);this.Yt(n,t,Ja.newNoDocument(t,ta.min()))}else Po(1===i);else{const s=this.ie(n);if(s!==i){const i=this.re(t,s);if(0!==i){this.ee(n);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=Su.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var i,s,r,o,a,c;const u={localCacheCount:e,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(u.bloomFilter={applied:0===t,hashCount:null!==(i=null==h?void 0:h.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(r=null===(s=null==h?void 0:h.bits)||void 0===s?void 0:s.bitmap)||void 0===r?void 0:r.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(i,s,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:i}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=n;let a,c;try{a=Na(s).toUint8Array()}catch(t){if(t instanceof Sa)return Lo("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new Nu(a,r,o)}catch(t){return Lo(t instanceof xu?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:i!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{const s=this.Gt.ue(),r=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.vt(r)||(this.Yt(t,n,null),i++)})),i}ce(t){const e=new Map;this.Qt.forEach(((n,i)=>{const s=this.se(i);if(s){if(n.current&&Cc(s.target)){const e=new ra(s.target.path);null!==this.jt.get(e)||this.ae(i,e)||this.Yt(i,e,Ja.newNoDocument(e,t))}n.Mt&&(e.set(i,n.Ot()),n.Ft())}}));let n=Gc();this.zt.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const i=new Ru(t,e,this.Wt,this.jt,n);return this.jt=Bc(),this.zt=Bu(),this.Wt=new wa(Yo),i}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const i=this.Zt(t);this.ae(t,e)?i.Bt(e,1):i.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new Fu,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new Ta(Yo),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||xo("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new Fu),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function Bu(){return new wa(ra.comparator)}function Uu(){return new wa(ra.comparator)}const ju={asc:"ASCENDING",desc:"DESCENDING"},$u={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qu={and:"AND",or:"OR"};class zu{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ku(t,e){return t.useProto3Json||ga(e)?e:{value:e}}function Hu(t){return Po(!!t),ta.fromTimestamp(function(t){const e=_a(t);return new Zo(e.seconds,e.nanos)}(t))}function Gu(t){const e=na.fromString(t);return Po(ch(e)),e}function Wu(t,e){const n=Gu(e);if(n.get(1)!==t.databaseId.projectId)throw new Bo(Vo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Bo(Vo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ra(Yu(n))}function Qu(t,e){return function(t,e){return function(t){return new na(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}(t.databaseId,e)}function Xu(t){return new na(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Yu(t){return Po(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ju(t,e){return{documents:[Qu(t,e.path)]}}function Zu(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=Qu(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Qu(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0!==t.length)return ah(oc.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:rh(t.field),direction:nh(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=Ku(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function th(t){let e=function(t){const e=Gu(t);return 4===e.length?na.emptyPath():Yu(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){Po(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=eh(t);return e instanceof oc&&cc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new nc(oh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,ga(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Za(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new Za(n,e)}(n.endAt)),function(t,e,n,i,s,r,o,a){return new Sc(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,u)}function eh(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=oh(t.unaryFilter.field);return rc.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=oh(t.unaryFilter.field);return rc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=oh(t.unaryFilter.field);return rc.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=oh(t.unaryFilter.field);return rc.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Oo()}}(t):void 0!==t.fieldFilter?function(t){return rc.create(oh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Oo()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return oc.create(t.compositeFilter.filters.map((t=>eh(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Oo()}}(t.compositeFilter.op))}(t):Oo()}function nh(t){return ju[t]}function ih(t){return $u[t]}function sh(t){return qu[t]}function rh(t){return{fieldPath:t.canonicalString()}}function oh(t){return sa.fromServerFormat(t.fieldPath)}function ah(t){return t instanceof rc?function(t){if("=="===t.op){if(Ga(t.value))return{unaryFilter:{field:rh(t.field),op:"IS_NAN"}};if(Ha(t.value))return{unaryFilter:{field:rh(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ga(t.value))return{unaryFilter:{field:rh(t.field),op:"IS_NOT_NAN"}};if(Ha(t.value))return{unaryFilter:{field:rh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rh(t.field),op:ih(t.op),value:t.value}}}(t):t instanceof oc?function(t){const e=t.getFilters().map((t=>ah(t)));return 1===e.length?e[0]:{compositeFilter:{op:sh(t.op),filters:e}}}(t):Oo()}function ch(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class uh{constructor(t,e,n,i,s=ta.min(),r=ta.min(),o=Aa.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new uh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new uh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new uh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new uh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class hh{constructor(t){this.fe=t}}function lh(t){const e=th({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Nc(e,e.limit,"L"):e}class dh{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(ka(t.integerValue));else if("doubleValue"in t){const n=ka(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),ma(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(Na(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Xa(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):Oo()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),ra.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}dh.Ve=new dh;class fh{constructor(){this.rn=new ph}addToCollectionParentIndex(t,e){return this.rn.add(e),da.resolve()}getCollectionParents(t,e){return da.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return da.resolve()}deleteFieldIndex(t,e){return da.resolve()}getDocumentsMatchingTarget(t,e){return da.resolve(null)}getIndexType(t,e){return da.resolve(0)}getFieldIndexes(t,e){return da.resolve([])}getNextCollectionGroupToUpdate(t){return da.resolve(null)}getMinOffset(t,e){return da.resolve(aa.min())}getMinOffsetFromCollectionGroup(t,e){return da.resolve(aa.min())}updateCollectionGroup(t,e,n){return da.resolve()}updateIndexEntries(t,e){return da.resolve()}}class ph{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Ta(na.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Ta(na.comparator)).toArray()}}new Uint8Array(0);class gh{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new gh(t,gh.DEFAULT_COLLECTION_PERCENTILE,gh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}gh.DEFAULT_COLLECTION_PERCENTILE=10,gh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gh.DEFAULT=new gh(41943040,gh.DEFAULT_COLLECTION_PERCENTILE,gh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gh.DISABLED=new gh(-1,0,0);class mh{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new mh(0)}static Mn(){return new mh(-1)}}class yh{constructor(){this.changes=new Fc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ja.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?da.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class vh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class wh{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&lu(n.mutation,t,Ca.empty(),Zo.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Gc()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Gc()){const i=qc();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=jc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=qc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Gc())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let s=Bc();const r=Kc(),o=Kc();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof pu)?s=s.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),lu(o.mutation,e,o.mutation.getFieldMask(),Zo.now())):r.set(e.key,Ca.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new vh(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Kc();let i=new wa(((t,e)=>t-e)),s=Gc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ca.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||Gc()).add(t);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=zc();c.forEach((t=>{if(!s.has(t)){const i=uu(e.get(t),n.get(t));null!==i&&u.set(t,i),s=s.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,u))}return da.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return ra.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):da.resolve(qc());let o=-1,a=s;return r.next((e=>da.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?da.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Gc()))).next((t=>({batchId:o,changes:$c(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ra(e)).next((t=>{let e=jc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let s=jc();return this.indexManager.getCollectionParents(t,i).next((r=>da.forEach(r,(r=>{const o=function(t,e){return new Sc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,Ja.newInvalidDocument(i)))}));let n=jc();return t.forEach(((t,s)=>{const r=i.get(t);void 0!==r&&lu(r.mutation,s,Ca.empty(),Zo.now()),Mc(e,s)&&(n=n.insert(t,s))})),n}))}}class Eh{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return da.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:Hu(n.createTime)}),da.resolve()}getNamedQuery(t,e){return da.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:lh(t.bundledQuery),readTime:Hu(t.readTime)}}(e)),da.resolve()}}class bh{constructor(){this.overlays=new wa(ra.comparator),this.ls=new Map}getOverlay(t,e){return da.resolve(this.overlays.get(e))}getOverlays(t,e){const n=qc();return da.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.we(t,e,i)})),da.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),da.resolve()}getOverlaysForCollection(t,e,n){const i=qc(),s=e.length+1,r=new ra(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return da.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new wa(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=qc(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=qc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return da.resolve(o)}we(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Eu(e,n));let s=this.ls.get(e);void 0===s&&(s=Gc(),this.ls.set(e,s)),this.ls.set(e,s.add(n.key))}}class Th{constructor(){this.fs=new Ta(Ih.ds),this.ws=new Ta(Ih._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Ih(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Ih(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new ra(new na([])),n=new Ih(e,t),i=new Ih(e,t+1),s=[];return this.ws.forEachInRange([n,i],(t=>{this.ys(t),s.push(t.key)})),s}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new ra(new na([])),n=new Ih(e,t),i=new Ih(e,t+1);let s=Gc();return this.ws.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new Ih(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ih{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return ra.comparator(t.key,e.key)||Yo(t.As,e.As)}static _s(t,e){return Yo(t.As,e.As)||ra.comparator(t.key,e.key)}}class Ch{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new Ta(Ih.ds)}checkEmpty(t){return da.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new wu(s,e,n,i);this.mutationQueue.push(r);for(const e of i)this.Rs=this.Rs.add(new Ih(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return da.resolve(r)}lookupMutationBatch(t,e){return da.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.bs(n),s=i<0?0:i;return da.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return da.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return da.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ih(e,0),i=new Ih(e,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([n,i],(t=>{const e=this.Ps(t.As);s.push(e)})),da.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ta(Yo);return e.forEach((t=>{const e=new Ih(t,0),i=new Ih(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,i],(t=>{n=n.add(t.As)}))})),da.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;ra.isDocumentKey(s)||(s=s.child(""));const r=new Ih(new ra(s),0);let o=new Ta(Yo);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.As)),!0)}),r),da.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Po(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return da.forEach(e.mutations,(i=>{const s=new Ih(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Ih(e,0),i=this.Rs.firstAfterOrEqual(n);return da.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,da.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Sh{constructor(t){this.Ds=t,this.docs=new wa(ra.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return da.resolve(n?n.document.mutableCopy():Ja.newInvalidDocument(e))}getEntries(t,e){let n=Bc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ja.newInvalidDocument(t))})),da.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Bc();const r=e.path,o=new ra(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||ca(oa(o),n)<=0||(i.has(o.key)||Mc(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return da.resolve(s)}getAllFromCollectionGroup(t,e,n,i){Oo()}Cs(t,e){return da.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Ah(this)}getSize(t){return da.resolve(this.size)}}class Ah extends yh{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.os.addEntry(t,i)):this.os.removeEntry(n)})),da.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class Dh{constructor(t){this.persistence=t,this.xs=new Fc((t=>Tc(t)),Ic),this.lastRemoteSnapshotVersion=ta.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Th,this.targetCount=0,this.Ms=mh.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),da.resolve()}getLastRemoteSnapshotVersion(t){return da.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return da.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),da.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),da.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new mh(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,da.resolve()}updateTargetData(t,e){return this.Fn(e),da.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,da.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.xs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),da.waitFor(s).next((()=>i))}getTargetCount(t){return da.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return da.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),da.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),da.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),da.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return da.resolve(n)}containsKey(t,e){return da.resolve(this.ks.containsKey(e))}}class _h{constructor(t,e){this.$s={},this.overlays={},this.Os=new pa(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new Dh(this),this.indexManager=new fh,this.remoteDocumentCache=function(t){return new Sh(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new hh(e),this.qs=new Eh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new Ch(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){xo("MemoryPersistence","Starting transaction:",t);const i=new kh(this.Os.next());return this.referenceDelegate.Us(),n(i).next((t=>this.referenceDelegate.Ks(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Gs(t,e){return da.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class kh extends ha{constructor(t){super(),this.currentSequenceNumber=t}}class Nh{constructor(t){this.persistence=t,this.Qs=new Th,this.js=null}static zs(t){return new Nh(t)}get Ws(){if(this.js)return this.js;throw Oo()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),da.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),da.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),da.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return da.forEach(this.Ws,(n=>{const i=ra.fromPath(n);return this.Hs(t,i).next((t=>{t||e.removeEntry(i,ta.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return da.or([()=>da.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class xh{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=i}static Li(t,e){let n=Gc(),i=Gc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new xh(t,e.fromCache,n,i)}}class Rh{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Ki(t,e).next((s=>s||this.Gi(t,e,i,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(Dc(e))return da.resolve(null);let n=kc(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=Nc(e,null,"F"),n=kc(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const s=Gc(...i);return this.Ui.getDocuments(t,s).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.ji(e,i);return this.zi(e,r,s,n.readTime)?this.Ki(t,Nc(e,null,"F")):this.Wi(t,r,e,n)}))))})))))}Gi(t,e,n,i){return Dc(e)||i.isEqual(ta.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((s=>{const r=this.ji(e,s);return this.zi(e,r,n,i)?this.Qi(t,e):(No()<=A.DEBUG&&xo("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Lc(e)),this.Wi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=ta.fromTimestamp(1e9===i?new Zo(n+1,0):new Zo(n,i));return new aa(s,ra.empty(),e)}(i,-1)))}))}ji(t,e){let n=new Ta(Oc(t));return e.forEach(((e,i)=>{Mc(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(t,e){return No()<=A.DEBUG&&xo("QueryEngine","Using full collection scan to execute query:",Lc(e)),this.Ui.getDocumentsMatchingQuery(t,e,aa.min())}Wi(t,e,n,i){return this.Ui.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Lh{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new wa(Yo),this.Yi=new Fc((t=>Tc(t)),Ic),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new wh(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function Mh(t,e){const n=Fo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((s=>(i=s,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],r=[];let o=Gc();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:s,addedBatchIds:r})))}))}))}function Oh(t){const e=Fo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}async function Ph(t,e,n){const i=Fo(t),s=i.Ji.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(t=>i.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!fa(t))throw t;xo("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ji=i.Ji.remove(e),i.Yi.delete(s.target)}function Fh(t,e,n){const i=Fo(t);let s=ta.min(),r=Gc();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=Fo(t),s=i.Yi.get(n);return void 0!==s?da.resolve(i.Ji.get(s)):i.Bs.getTargetData(e,n)}(i,t,kc(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>i.Hi.getDocumentsMatchingQuery(t,e,n?s:ta.min(),n?r:Gc()))).next((t=>(function(t,e,n){let i=t.Xi.get(e)||ta.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Xi.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ir:r})))))}class Vh{constructor(){this.activeTargetIds=Wc}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Bh{constructor(){this.Hr=new Vh,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new Vh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Uh{Yr(t){}shutdown(){}}class jh{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){xo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){xo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let $h=null;function qh(){return null===$h?$h=268435456+Math.round(2147483648*Math.random()):$h++,"0x"+$h.toString(16)}const zh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Kh{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const Hh="WebChannelConnection";class Gh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,i,s){const r=qh(),o=this.To(t,e);xo("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const a={};return this.Eo(a,i,s),this.Ao(t,o,a,n).then((e=>(xo("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw Lo("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,i,s,r){return this.Io(t,e,n,i,s)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+_o,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=zh[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,i){const s=qh();return new Promise(((r,o)=>{const a=new Io;a.setWithCredentials(!0),a.listenOnce(vo.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case yo.NO_ERROR:const e=a.getResponseJson();xo(Hh,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),r(e);break;case yo.TIMEOUT:xo(Hh,`RPC '${t}' ${s} timed out`),o(new Bo(Vo.DEADLINE_EXCEEDED,"Request time out"));break;case yo.HTTP_ERROR:const n=a.getStatus();if(xo(Hh,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Vo).indexOf(e)>=0?e:Vo.UNKNOWN}(e.status);o(new Bo(t,e.message))}else o(new Bo(Vo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Bo(Vo.UNAVAILABLE,"Connection failed."));break;default:Oo()}}finally{xo(Hh,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(i);xo(Hh,`RPC '${t}' ${s} sending request:`,i),a.send(e,"POST",c,n,15)}))}Ro(t,e,n){const i=qh(),s=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=go(),o=mo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new bo({})),this.Eo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");xo(Hh,`Creating RPC '${t}' stream ${i}: ${u}`,a);const h=r.createWebChannel(u,a);let l=!1,d=!1;const f=new Kh({ro:e=>{d?xo(Hh,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(l||(xo(Hh,`Opening RPC '${t}' stream ${i} transport.`),h.open(),l=!0),xo(Hh,`RPC '${t}' stream ${i} sending:`,e),h.send(e))},oo:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,To.EventType.OPEN,(()=>{d||xo(Hh,`RPC '${t}' stream ${i} transport opened.`)})),p(h,To.EventType.CLOSE,(()=>{d||(d=!0,xo(Hh,`RPC '${t}' stream ${i} transport closed`),f.wo())})),p(h,To.EventType.ERROR,(e=>{d||(d=!0,Lo(Hh,`RPC '${t}' stream ${i} transport errored:`,e),f.wo(new Bo(Vo.UNAVAILABLE,"The operation could not be completed")))})),p(h,To.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];Po(!!s);const r=s,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){xo(Hh,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=Tu[t];if(void 0!==e)return Cu(e)}(e),s=o.message;void 0===n&&(n=Vo.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.wo(new Bo(n,s)),h.close()}else xo(Hh,`RPC '${t}' stream ${i} received:`,s),f._o(s)}})),p(o,wo.STAT_EVENT,(e=>{e.stat===Eo.PROXY?xo(Hh,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Eo.NOPROXY&&xo(Hh,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Wh(){return"undefined"!=typeof document?document:null}function Qh(t){return new zu(t,!0)}class Xh{constructor(t,e,n=1e3,i=1.5,s=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,e-n);i>0&&xo("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Yh{constructor(t,e,n,i,s,r,o,a){this.ii=t,this.$o=n,this.Oo=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Xh(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===Vo.RESOURCE_EXHAUSTED?(Ro(e.toString()),Ro("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===Vo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new Bo(Vo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return xo("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(xo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Jh extends Yh{constructor(t,e,n,i,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,r),this.serializer=s}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Oo()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(t,e){return t.useProto3Json?(Po(void 0===e||"string"==typeof e),Aa.fromBase64String(e||"")):(Po(void 0===e||e instanceof Uint8Array),Aa.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Vo.UNKNOWN:Cu(t.code);return new Bo(e,t.message||"")}(o);n=new Pu(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=Wu(t,i.document.name),r=Hu(i.document.updateTime),o=i.document.createTime?Hu(i.document.createTime):ta.min(),a=new Ya({mapValue:{fields:i.document.fields}}),c=Ja.newFoundDocument(s,r,o,a),u=i.targetIds||[],h=i.removedTargetIds||[];n=new Mu(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=Wu(t,i.document),r=i.readTime?Hu(i.readTime):ta.min(),o=Ja.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Mu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=Wu(t,i.document),r=i.removedTargetIds||[];n=new Mu([],r,s,null)}else{if(!("filter"in e))return Oo();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:s}=t,r=new bu(i,s),o=t.targetId;n=new Ou(o,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ta.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ta.min():e.readTime?Hu(e.readTime):ta.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=Xu(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=Cc(i)?{documents:Ju(t,i)}:{query:Zu(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const i=Ku(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(ta.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const i=Ku(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Oo()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=Xu(this.serializer),e.removeTarget=t,this.Wo(e)}}class Zh extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new Bo(Vo.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Io(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Vo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bo(Vo.UNKNOWN,t.toString())}))}vo(t,e,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.vo(t,e,n,s,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Vo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Bo(Vo.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class tl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Ro(e),this.mu=!1):xo("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class el{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{hl(this)&&(xo("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Fo(t);e.vu.add(4),await il(e),e.bu.set("Unknown"),e.vu.delete(4),await nl(e)}(this))}))})),this.bu=new tl(n,i)}}async function nl(t){if(hl(t))for(const e of t.Ru)await e(!0)}async function il(t){for(const e of t.Ru)await e(!1)}function sl(t,e){const n=Fo(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),ul(n)?cl(n):yl(n).Ko()&&ol(n,e))}function rl(t,e){const n=Fo(t),i=yl(n);n.Au.delete(e),i.Ko()&&al(n,e),0===n.Au.size&&(i.Ko()?i.jo():hl(n)&&n.bu.set("Unknown"))}function ol(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ta.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}yl(t).su(e)}function al(t,e){t.Vu.qt(e),yl(t).iu(e)}function cl(t){t.Vu=new Vu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),yl(t).start(),t.bu.gu()}function ul(t){return hl(t)&&!yl(t).Uo()&&t.Au.size>0}function hl(t){return 0===Fo(t).vu.size}function ll(t){t.Vu=void 0}async function dl(t){t.Au.forEach(((e,n)=>{ol(t,e)}))}async function fl(t,e){ll(t),ul(t)?(t.bu.Iu(e),cl(t)):t.bu.set("Unknown")}async function pl(t,e,n){if(t.bu.set("Online"),e instanceof Pu&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.Au.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.Au.delete(i),t.Vu.removeTarget(i))}(t,e)}catch(n){xo("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await gl(t,n)}else if(e instanceof Mu?t.Vu.Ht(e):e instanceof Ou?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(ta.min()))try{const e=await Oh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Au.get(i);s&&t.Au.set(i,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.Au.get(e);if(!i)return;t.Au.set(e,i.withResumeToken(Aa.EMPTY_BYTE_STRING,i.snapshotVersion)),al(t,e);const s=new uh(i.target,e,n,i.sequenceNumber);ol(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){xo("RemoteStore","Failed to raise snapshot:",e),await gl(t,e)}}async function gl(t,e,n){if(!fa(e))throw e;t.vu.add(1),await il(t),t.bu.set("Offline"),n||(n=()=>Oh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{xo("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await nl(t)}))}async function ml(t,e){const n=Fo(t);n.asyncQueue.verifyOperationInProgress(),xo("RemoteStore","RemoteStore received new credentials");const i=hl(n);n.vu.add(3),await il(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await nl(n)}function yl(t){return t.Su||(t.Su=function(t,e,n){const i=Fo(t);return i.fu(),new Jh(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{uo:dl.bind(null,t),ao:fl.bind(null,t),nu:pl.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),ul(t)?cl(t):t.bu.set("Unknown")):(await t.Su.stop(),ll(t))}))),t.Su}class vl{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Uo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new vl(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bo(Vo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wl(t,e){if(Ro("AsyncQueue",`${e}: ${t}`),fa(t))return new Bo(Vo.UNAVAILABLE,`${e}: ${t}`);throw t}class El{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ra.comparator(e.key,n.key):(t,e)=>ra.comparator(t.key,e.key),this.keyedMap=jc(),this.sortedSet=new wa(this.comparator)}static emptySet(t){return new El(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof El))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new El;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class bl{constructor(){this.Cu=new wa(ra.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):Oo():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Tl{constructor(t,e,n,i,s,r,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,s){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new Tl(t,e,El.emptySet(e),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&xc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Il{constructor(){this.Nu=void 0,this.listeners=[]}}class Cl{constructor(){this.queries=new Fc((t=>Rc(t)),xc),this.onlineState="Unknown",this.ku=new Set}}function Sl(t,e){const n=Fo(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.$u(t)&&(i=!0);s.Nu=t}}i&&Dl(n)}function Al(t,e,n){const i=Fo(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}function Dl(t){t.ku.forEach((t=>{t.next()}))}class _l{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Tl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=Tl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class kl{constructor(t){this.key=t}}class Nl{constructor(t){this.key=t}}class xl{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Gc(),this.mutatedKeys=Gc(),this.tc=Oc(t),this.ec=new El(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new bl,i=e?e.ec:this.ec;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),h=Mc(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.rc(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.tc(h,a)>0||c&&this.tc(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ec:r,ic:n,zi:o,mutatedKeys:s}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const s=t.ic.xu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Oo()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const r=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==s.length||a?{snapshot:new Tl(this.query,t.ec,i,s,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:r}:{cc:r}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new bl,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=Gc(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new Nl(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new kl(n))})),e}hc(t){this.Yu=t.ir,this.Zu=Gc();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return Tl.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Rl{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ll{constructor(t){this.key=t,this.fc=!1}}class Ml{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.dc={},this.wc=new Fc((t=>Rc(t)),xc),this._c=new Map,this.mc=new Set,this.gc=new wa(ra.comparator),this.yc=new Map,this.Ic=new Th,this.Tc={},this.Ec=new Map,this.Ac=mh.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Ol(t,e){const n=function(t){const e=Fo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Fl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Bl.bind(null,e),e.dc.nu=Sl.bind(null,e.eventManager),e.dc.Pc=Al.bind(null,e.eventManager),e}(t);let i,s;const r=n.wc.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.lc();else{const t=await function(t,e){const n=Fo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.Bs.getTargetData(t,e).next((s=>s?(i=s,da.resolve(i)):n.Bs.allocateTargetId(t).next((s=>(i=new uh(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.Ji.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,kc(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await async function(t,e,n,i,s){t.Rc=(e,n,i)=>async function(t,e,n,i){let s=e.view.sc(n);s.zi&&(s=await Fh(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,s))));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return $l(t,e.targetId,o.cc),o.snapshot}(t,e,n,i);const r=await Fh(t.localStore,e,!0),o=new xl(e,r.ir),a=o.sc(r.documents),c=Lu.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);$l(t,n,u.cc);const h=new Rl(e,n,o);return t.wc.set(e,h),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),u.snapshot}(n,e,i,"current"===r,t.resumeToken),n.isPrimaryClient&&sl(n.remoteStore,t)}return s}async function Pl(t,e){const n=Fo(t),i=n.wc.get(e),s=n._c.get(i.targetId);if(s.length>1)return n._c.set(i.targetId,s.filter((t=>!xc(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Ph(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),rl(n.remoteStore,i.targetId),Ul(n,i.targetId)})).catch(la)):(Ul(n,i.targetId),await Ph(n.localStore,i.targetId,!0))}async function Fl(t,e){const n=Fo(t);try{const t=await function(t,e){const n=Fo(t),i=e.snapshotVersion;let s=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Zi.newChangeBuffer({trackRemovals:!0});s=n.Ji;const o=[];e.targetChanges.forEach(((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,r.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Aa.EMPTY_BYTE_STRING,ta.min()).withLastLimboFreeSnapshotVersion(ta.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.Bs.updateTargetData(t,u))}));let a=Bc(),c=Gc();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=Gc(),s=Gc();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Bc();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(ta.min())?(e.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),i=i.insert(n,r)):xo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{nr:i,sr:s}}))}(t,r,e.documentUpdates).next((t=>{a=t.nr,c=t.sr}))),!i.isEqual(ta.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return da.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.yc.get(e);i&&(Po(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.fc=!0:t.modifiedDocuments.size>0?Po(i.fc):t.removedDocuments.size>0&&(Po(i.fc),i.fc=!1))})),await Kl(n,t,e)}catch(t){await la(t)}}function Vl(t,e,n){const i=Fo(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.wc.forEach(((n,i)=>{const s=i.view.Mu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Fo(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(i=!0)})),i&&Dl(n)}(i.eventManager,e),t.length&&i.dc.nu(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Bl(t,e,n){const i=Fo(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.yc.get(e),r=s&&s.key;if(r){let t=new wa(ra.comparator);t=t.insert(r,Ja.newNoDocument(r,ta.min()));const n=Gc().add(r),s=new Ru(ta.min(),new Map,new wa(Yo),t,n);await Fl(i,s),i.gc=i.gc.remove(r),i.yc.delete(e),zl(i)}else await Ph(i.localStore,e,!1).then((()=>Ul(i,e,n))).catch(la)}function Ul(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t._c.get(e))t.wc.delete(i),n&&t.dc.Pc(i,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||jl(t,e)}))}function jl(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(rl(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),zl(t))}function $l(t,e,n){for(const i of n)i instanceof kl?(t.Ic.addReference(i.key,e),ql(t,i)):i instanceof Nl?(xo("SyncEngine","Document no longer in limbo: "+i.key),t.Ic.removeReference(i.key,e),t.Ic.containsKey(i.key)||jl(t,i.key)):Oo()}function ql(t,e){const n=e.key,i=n.path.canonicalString();t.gc.get(n)||t.mc.has(i)||(xo("SyncEngine","New document in limbo: "+n),t.mc.add(i),zl(t))}function zl(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new ra(na.fromString(e)),i=t.Ac.next();t.yc.set(i,new Ll(n)),t.gc=t.gc.insert(n,i),sl(t.remoteStore,new uh(kc(Ac(n.path)),i,"TargetPurposeLimboResolution",pa.ct))}}async function Kl(t,e,n){const i=Fo(t),s=[],r=[],o=[];i.wc.isEmpty()||(i.wc.forEach(((t,a)=>{o.push(i.Rc(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=xh.Li(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.dc.nu(s),await async function(t,e){const n=Fo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>da.forEach(e,(e=>da.forEach(e.Fi,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>da.forEach(e.Bi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!fa(t))throw t;xo("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,s)}}}(i.localStore,r))}async function Hl(t,e){const n=Fo(t);if(!n.currentUser.isEqual(e)){xo("SyncEngine","User change. New user:",e.toKey());const t=await Mh(n.localStore,e);n.currentUser=e,function(t,e){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new Bo(Vo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Kl(n,t.er)}}function Gl(t,e){const n=Fo(t),i=n.yc.get(e);if(i&&i.fc)return Gc().add(i.key);{let t=Gc();const i=n._c.get(e);if(!i)return t;for(const e of i){const i=n.wc.get(e);t=t.unionWith(i.view.nc)}return t}}class Wl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Qh(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new Lh(t,e,n,i)}(this.persistence,new Rh,t.initialUser,this.serializer)}createPersistence(t){return new _h(Nh.zs,this.serializer)}createSharedClientState(t){return new Bh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ql{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Vl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hl.bind(null,this.syncEngine),await async function(t,e){const n=Fo(t);e?(n.vu.delete(2),await nl(n)):e||(n.vu.add(2),await il(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Cl}createDatastore(t){const e=Qh(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Gh(i));var i;return function(t,e,n,i){return new Zh(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>Vl(this.syncEngine,t,0),r=jh.D()?new jh:new Uh,new el(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new Ml(t,e,n,i,s,r);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Fo(t);xo("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await il(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class Xl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):Ro("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Yl{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Do.UNAUTHENTICATED,this.clientId=Xo.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{xo("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(xo("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bo(Vo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Uo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=wl(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Jl(t,e){t.asyncQueue.verifyOperationInProgress(),xo("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Mh(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Zl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){xo("FirestoreClient","Using user provided OfflineComponentProvider");try{await Jl(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Vo.FAILED_PRECONDITION||t.code===Vo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Lo("Error using user provided cache. Falling back to memory cache: "+n),await Jl(t,new Wl)}}else xo("FirestoreClient","Using default OfflineComponentProvider"),await Jl(t,new Wl);return t._offlineComponents}(t);xo("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>ml(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>ml(e.remoteStore,n))),t._onlineComponents=e}async function td(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(xo("FirestoreClient","Using user provided OnlineComponentProvider"),await Zl(t,t._uninitializedComponentsProvider._online)):(xo("FirestoreClient","Using default OnlineComponentProvider"),await Zl(t,new Ql))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Ol.bind(null,e.syncEngine),n.onUnlisten=Pl.bind(null,e.syncEngine),n}function ed(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const nd=new Map;function id(t){if(ra.isDocumentKey(t))throw new Bo(Vo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function sd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Bo(Vo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Oo()}(t);throw new Bo(Vo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class rd{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Bo(Vo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Bo(Vo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new Bo(Vo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ed(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Bo(Vo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Bo(Vo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Bo(Vo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class od{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Bo(Vo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Bo(Vo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new $o;switch(t.type){case"firstParty":return new Ho(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Bo(Vo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=nd.get(t);e&&(xo("ComponentProvider","Removing Datastore"),nd.delete(t),e.terminate())}(this),Promise.resolve()}}class ad{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ud(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ad(this.firestore,t,this._key)}}class cd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new cd(this.firestore,t,this._query)}}class ud extends cd{constructor(t,e,n){super(t,e,Ac(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ad(this.firestore,null,new ra(t))}withConverter(t){return new ud(this.firestore,t,this._path)}}class hd{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Xh(this,"async_queue_retry"),this.Xc=()=>{const t=Wh();t&&xo("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=Wh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=Wh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new Uo;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!fa(t))throw t;xo("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Ro("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const i=vl.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(i),i}Zc(){this.Wc&&Oo()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}function ld(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class dd extends od{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new hd,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||fd(this),this._firestoreClient.terminate()}}function fd(t){var e,n,i;const s=t._freezeSettings(),r=function(t,e,n,i){return new Ma(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,ed(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Yl(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=s.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}class pd{constructor(t){this._byteString=t}static fromBase64String(t){try{return new pd(Aa.fromBase64String(t))}catch(t){throw new Bo(Vo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new pd(Aa.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class gd{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Bo(Vo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class md{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Bo(Vo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Bo(Vo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Yo(this._lat,t._lat)||Yo(this._long,t._long)}}const yd=new RegExp("[~\\*/\\[\\]]");function vd(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new Bo(Vo.INVALID_ARGUMENT,a+t+c)}class wd{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ad(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Ed(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(bd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ed extends wd{data(){return super.data()}}function bd(t,e){return"string"==typeof e?function(t,e,n){if(e.search(yd)>=0)throw vd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new gd(...e.split("."))._internalPath}catch(i){throw vd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof gd?e._internalPath:e._delegate._internalPath}class Td{convertValue(t,e="none"){switch(Fa(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ka(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Na(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Oo()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return va(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new md(ka(t.latitude),ka(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ra(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(La(t));default:return null}}convertTimestamp(t){const e=_a(t);return new Zo(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=na.fromString(t);Po(ch(n));const i=new Oa(n.get(1),n.get(3)),s=new ra(n.popFirst(5));return i.isEqual(e)||Ro(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class Id{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Cd extends wd{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Sd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(bd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Sd extends Cd{data(t={}){return super.data(t)}}class Ad{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Id(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Sd(this._firestore,this._userDataWriter,n.key,n,new Id(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Bo(Vo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const i=new Sd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Id(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new Sd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Id(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Dd(e.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Dd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Oo()}}class _d extends Td{constructor(t){super(),this.firestore=t}convertBytes(t){return new pd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ad(this.firestore,null,e)}}!function(t,e=!0){_o="9.22.0",rt(new b("firestore",((t,{instanceIdentifier:n,options:i})=>{const s=t.getProvider("app").getImmediate(),r=new dd(new zo(t.getProvider("auth-internal")),new Wo(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Bo(Vo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Oa(t.options.projectId,e)}(s,n),s);return i=Object.assign({useFetchStreams:e},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),lt(Ao,"3.12.0",t),lt(Ao,"3.12.0","esm2017")}();const kd=ut({apiKey:"AIzaSyD2s8Pqa6pG68N5Ztu7oV9ymT2KHsCinSo",authDomain:"mt-aas.firebaseapp.com",projectId:"mt-aas",storageBucket:"mt-aas.appspot.com",messagingSenderId:"822493253485",appId:"1:822493253485:web:3944a00e63e7c3552a1464",measurementId:"G-9Y41K5G1V3"}),Nd=(function(t=ht()){const e=ot(t=E(t),Ae);e.isInitialized()?e.getImmediate():function(t,e={}){const n=ot(t,Ae);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw Le.create("already-initialized")}n.initialize({options:e})}(t)}(kd),function(t,e){const n="string"==typeof t?t:"(default)",i=ot("object"==typeof t?t:ht(),"firestore").getImmediate({identifier:n});if(!i._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=r())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("firestore");t&&function(t,e,n,i={}){var r;const o=(t=sd(t,od))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Lo("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:`${e}:${n}`,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Do.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new Bo(Vo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Do(o)}t._authCredentials=new qo(new jo(e,n))}}(i,...t)}return i}(kd)),xd=document.getElementById("model-container"),Rd=new THREE.Scene,Ld=new THREE.PerspectiveCamera(75,xd.clientWidth/xd.clientHeight,.1,1e4),Md=new THREE.WebGLRenderer({antialias:!0});Md.setSize(xd.clientWidth,xd.clientHeight),Md.setClearColor(15790320),xd.appendChild(Md.domElement);const Od=new THREE.AmbientLight(16777215,.4);Rd.add(Od);const Pd=new THREE.PointLight(16777215,1,100);Pd.position.set(10,10,10),Rd.add(Pd),Ld.position.z=5,(new THREE.OBJLoader).load("SMC_JP_HRS050A200/HRS050-A-20(0).obj",(t=>{const e=(new THREE.TextureLoader).load("eisen_0004_c/metal1.jpg");t=new THREE.Mesh(t.children[0].geometry,new THREE.MeshPhongMaterial({map:e,specular:1118481,shininess:30})),Rd.add(t),t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}),(t=>{console.log(t.loaded/t.total*100+"% loaded")}),(t=>{console.error("An error occurred",t)}));const Fd=new THREE.OrbitControls(Ld,Md.domElement);Fd.enableDamping=!0,Fd.dampingFactor=.1,function t(){requestAnimationFrame(t),Fd.update(),Md.render(Rd,Ld)}(),window.addEventListener("resize",(()=>{const t=xd.clientWidth,e=xd.clientHeight;Ld.aspect=t/e,Ld.updateProjectionMatrix(),Md.setSize(t,e)})),function(t,...e){var n,i,s;t=E(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ld(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(ld(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(i=t.error)||void 0===i?void 0:i.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let c,u,h;if(t instanceof ad)u=sd(t.firestore,dd),h=Ac(t._key.path),c={next:n=>{e[o]&&e[o](function(t,e,n){const i=n.docs.get(e._key),s=new _d(t);return new Cd(t,s,e._key,i,new Id(n.hasPendingWrites,n.fromCache),e.converter)}(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=sd(t,cd);u=sd(n.firestore,dd),h=n._query;const i=new _d(u);c={next:t=>{e[o]&&e[o](new Ad(u,i,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Bo(Vo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}!function(t,e,n,i){const s=new Xl(i),r=new _l(e,s,n);t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Fo(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new Il),s)try{r.Nu=await n.onListen(i)}catch(t){const n=wl(t,`Initialization of query '${Lc(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.Mu(n.onlineState),r.Nu&&e.$u(r.Nu)&&Dl(n)}(await td(t),r)))}(function(t){return t._firestoreClient||fd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(u),h,a,c)}(function(t,e,...n){if(t=E(t),function(t,e,n){if(!n)throw new Bo(Vo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof od){const i=na.fromString(e,...n);return id(i),new ud(t,null,i)}{if(!(t instanceof ad||t instanceof ud))throw new Bo(Vo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(na.fromString(e,...n));return id(i),new ud(t.firestore,null,i)}}(Nd,"initial_data"),(t=>{const e=document.getElementById("data-display");e.innerHTML="",t.forEach((t=>{const n=t.data().temperature,i=document.createElement("li");i.textContent=`Temperature: ${n} degree`,e.appendChild(i)}))}))})();